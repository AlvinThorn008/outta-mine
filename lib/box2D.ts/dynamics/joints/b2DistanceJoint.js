/*
 * Copyright (c) 2006-2007 Erin Catto http://www.box2d.org
 *
 * This software is provided 'as-is', without any express or implied
 * warranty.  In no event will the authors be held liable for any damages
 * arising from the use of this software.
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 * 1. The origin of this software must not be misrepresented; you must not
 * claim that you wrote the original software. If you use this software
 * in a product, an acknowledgment in the product documentation would be
 * appreciated but is not required.
 * 2. Altered source versions must be plainly marked as such, and must not be
 * misrepresented as being the original software.
 * 3. This notice may not be removed or altered from any source distribution.
 */
import { b2_linearSlop, b2_maxLinearCorrection, b2_pi, b2Maybe } from '../../common/b2Settings';
import { b2Abs, b2Clamp, b2Rot, b2Vec2 } from '../../common/b2Math';
import { b2Joint, b2JointDef } from './b2Joint';
/// Distance joint definition. This requires defining an
/// anchor point on both bodies and the non-zero length of the
/// distance joint. The definition uses local anchor points
/// so that the initial configuration can violate the constraint
/// slightly. This helps when saving and loading a game.
/// @warning Do not use a zero or short length.
export class b2DistanceJointDef extends b2JointDef {
    constructor() {
        super(3 /* e_distanceJoint */);
        this.localAnchorA = new b2Vec2();
        this.localAnchorB = new b2Vec2();
        this.length = 1;
        this.frequencyHz = 0;
        this.dampingRatio = 0;
    }
    Initialize(b1, b2, anchor1, anchor2) {
        this.bodyA = b1;
        this.bodyB = b2;
        this.bodyA.GetLocalPoint(anchor1, this.localAnchorA);
        this.bodyB.GetLocalPoint(anchor2, this.localAnchorB);
        this.length = b2Vec2.DistanceVV(anchor1, anchor2);
        this.frequencyHz = 0;
        this.dampingRatio = 0;
    }
}
export class b2DistanceJoint extends b2Joint {
    constructor(def) {
        super(def);
        this.m_frequencyHz = 0;
        this.m_dampingRatio = 0;
        this.m_bias = 0;
        // Solver shared
        this.m_localAnchorA = new b2Vec2();
        this.m_localAnchorB = new b2Vec2();
        this.m_gamma = 0;
        this.m_impulse = 0;
        this.m_length = 0;
        // Solver temp
        this.m_indexA = 0;
        this.m_indexB = 0;
        this.m_u = new b2Vec2();
        this.m_rA = new b2Vec2();
        this.m_rB = new b2Vec2();
        this.m_localCenterA = new b2Vec2();
        this.m_localCenterB = new b2Vec2();
        this.m_invMassA = 0;
        this.m_invMassB = 0;
        this.m_invIA = 0;
        this.m_invIB = 0;
        this.m_mass = 0;
        this.m_qA = new b2Rot();
        this.m_qB = new b2Rot();
        this.m_lalcA = new b2Vec2();
        this.m_lalcB = new b2Vec2();
        this.m_frequencyHz = b2Maybe(def.frequencyHz, 0);
        this.m_dampingRatio = b2Maybe(def.dampingRatio, 0);
        this.m_localAnchorA.Copy(def.localAnchorA);
        this.m_localAnchorB.Copy(def.localAnchorB);
        this.m_length = def.length;
    }
    GetAnchorA(out) {
        return this.m_bodyA.GetWorldPoint(this.m_localAnchorA, out);
    }
    GetAnchorB(out) {
        return this.m_bodyB.GetWorldPoint(this.m_localAnchorB, out);
    }
    GetReactionForce(inv_dt, out) {
        out.x = inv_dt * this.m_impulse * this.m_u.x;
        out.y = inv_dt * this.m_impulse * this.m_u.y;
        return out;
    }
    GetReactionTorque(inv_dt) {
        return 0;
    }
    GetLocalAnchorA() {
        return this.m_localAnchorA;
    }
    GetLocalAnchorB() {
        return this.m_localAnchorB;
    }
    SetLength(length) {
        this.m_length = length;
    }
    Length() {
        return this.m_length;
    }
    SetFrequency(hz) {
        this.m_frequencyHz = hz;
    }
    GetFrequency() {
        return this.m_frequencyHz;
    }
    SetDampingRatio(ratio) {
        this.m_dampingRatio = ratio;
    }
    GetDampingRatio() {
        return this.m_dampingRatio;
    }
    InitVelocityConstraints(data) {
        this.m_indexA = this.m_bodyA.m_islandIndex;
        this.m_indexB = this.m_bodyB.m_islandIndex;
        this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);
        this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);
        this.m_invMassA = this.m_bodyA.m_invMass;
        this.m_invMassB = this.m_bodyB.m_invMass;
        this.m_invIA = this.m_bodyA.m_invI;
        this.m_invIB = this.m_bodyB.m_invI;
        const cA = data.positions[this.m_indexA].c;
        const aA = data.positions[this.m_indexA].a;
        const vA = data.velocities[this.m_indexA].v;
        let wA = data.velocities[this.m_indexA].w;
        const cB = data.positions[this.m_indexB].c;
        const aB = data.positions[this.m_indexB].a;
        const vB = data.velocities[this.m_indexB].v;
        let wB = data.velocities[this.m_indexB].w;
        // const qA: b2Rot = new b2Rot(aA), qB: b2Rot = new b2Rot(aB);
        const qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);
        // m_rA = b2Mul(qA, m_localAnchorA - m_localCenterA);
        b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);
        b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);
        // m_rB = b2Mul(qB, m_localAnchorB - m_localCenterB);
        b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);
        b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);
        // m_u = cB + m_rB - cA - m_rA;
        this.m_u.x = cB.x + this.m_rB.x - cA.x - this.m_rA.x;
        this.m_u.y = cB.y + this.m_rB.y - cA.y - this.m_rA.y;
        // Handle singularity.
        const length = this.m_u.Length();
        if (length > b2_linearSlop) {
            this.m_u.SelfMul(1 / length);
        }
        else {
            this.m_u.SetZero();
        }
        // float32 crAu = b2Cross(m_rA, m_u);
        const crAu = b2Vec2.CrossVV(this.m_rA, this.m_u);
        // float32 crBu = b2Cross(m_rB, m_u);
        const crBu = b2Vec2.CrossVV(this.m_rB, this.m_u);
        // float32 invMass = m_invMassA + m_invIA * crAu * crAu + m_invMassB + m_invIB * crBu * crBu;
        let invMass = this.m_invMassA + this.m_invIA * crAu * crAu + this.m_invMassB + this.m_invIB * crBu * crBu;
        // Compute the effective mass matrix.
        this.m_mass = invMass !== 0 ? 1 / invMass : 0;
        if (this.m_frequencyHz > 0) {
            const C = length - this.m_length;
            // Frequency
            const omega = 2 * b2_pi * this.m_frequencyHz;
            // Damping coefficient
            const d = 2 * this.m_mass * this.m_dampingRatio * omega;
            // Spring stiffness
            const k = this.m_mass * omega * omega;
            // magic formulas
            const h = data.step.dt;
            this.m_gamma = h * (d + h * k);
            this.m_gamma = this.m_gamma !== 0 ? 1 / this.m_gamma : 0;
            this.m_bias = C * h * k * this.m_gamma;
            invMass += this.m_gamma;
            this.m_mass = invMass !== 0 ? 1 / invMass : 0;
        }
        else {
            this.m_gamma = 0;
            this.m_bias = 0;
        }
        if (data.step.warmStarting) {
            // Scale the impulse to support a variable time step.
            this.m_impulse *= data.step.dtRatio;
            // b2Vec2 P = m_impulse * m_u;
            const P = b2Vec2.MulSV(this.m_impulse, this.m_u, b2DistanceJoint.InitVelocityConstraints_s_P);
            // vA -= m_invMassA * P;
            vA.SelfMulSub(this.m_invMassA, P);
            // wA -= m_invIA * b2Cross(m_rA, P);
            wA -= this.m_invIA * b2Vec2.CrossVV(this.m_rA, P);
            // vB += m_invMassB * P;
            vB.SelfMulAdd(this.m_invMassB, P);
            // wB += m_invIB * b2Cross(m_rB, P);
            wB += this.m_invIB * b2Vec2.CrossVV(this.m_rB, P);
        }
        else {
            this.m_impulse = 0;
        }
        // data.velocities[this.m_indexA].v = vA;
        data.velocities[this.m_indexA].w = wA;
        // data.velocities[this.m_indexB].v = vB;
        data.velocities[this.m_indexB].w = wB;
    }
    SolveVelocityConstraints(data) {
        const vA = data.velocities[this.m_indexA].v;
        let wA = data.velocities[this.m_indexA].w;
        const vB = data.velocities[this.m_indexB].v;
        let wB = data.velocities[this.m_indexB].w;
        // b2Vec2 vpA = vA + b2Cross(wA, m_rA);
        const vpA = b2Vec2.AddVCrossSV(vA, wA, this.m_rA, b2DistanceJoint.SolveVelocityConstraints_s_vpA);
        // b2Vec2 vpB = vB + b2Cross(wB, m_rB);
        const vpB = b2Vec2.AddVCrossSV(vB, wB, this.m_rB, b2DistanceJoint.SolveVelocityConstraints_s_vpB);
        // float32 Cdot = b2Dot(m_u, vpB - vpA);
        const Cdot = b2Vec2.DotVV(this.m_u, b2Vec2.SubVV(vpB, vpA, b2Vec2.s_t0));
        const impulse = -this.m_mass * (Cdot + this.m_bias + this.m_gamma * this.m_impulse);
        this.m_impulse += impulse;
        // b2Vec2 P = impulse * m_u;
        const P = b2Vec2.MulSV(impulse, this.m_u, b2DistanceJoint.SolveVelocityConstraints_s_P);
        // vA -= m_invMassA * P;
        vA.SelfMulSub(this.m_invMassA, P);
        // wA -= m_invIA * b2Cross(m_rA, P);
        wA -= this.m_invIA * b2Vec2.CrossVV(this.m_rA, P);
        // vB += m_invMassB * P;
        vB.SelfMulAdd(this.m_invMassB, P);
        // wB += m_invIB * b2Cross(m_rB, P);
        wB += this.m_invIB * b2Vec2.CrossVV(this.m_rB, P);
        // data.velocities[this.m_indexA].v = vA;
        data.velocities[this.m_indexA].w = wA;
        // data.velocities[this.m_indexB].v = vB;
        data.velocities[this.m_indexB].w = wB;
    }
    SolvePositionConstraints(data) {
        if (this.m_frequencyHz > 0) {
            // There is no position correction for soft distance constraints.
            return true;
        }
        const cA = data.positions[this.m_indexA].c;
        let aA = data.positions[this.m_indexA].a;
        const cB = data.positions[this.m_indexB].c;
        let aB = data.positions[this.m_indexB].a;
        // const qA: b2Rot = new b2Rot(aA), qB: b2Rot = new b2Rot(aB);
        const qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);
        // b2Vec2 rA = b2Mul(qA, m_localAnchorA - m_localCenterA);
        const rA = b2Rot.MulRV(qA, this.m_lalcA, this.m_rA); // use m_rA
        // b2Vec2 rB = b2Mul(qB, m_localAnchorB - m_localCenterB);
        const rB = b2Rot.MulRV(qB, this.m_lalcB, this.m_rB); // use m_rB
        // b2Vec2 u = cB + rB - cA - rA;
        const u = this.m_u; // use m_u
        u.x = cB.x + rB.x - cA.x - rA.x;
        u.y = cB.y + rB.y - cA.y - rA.y;
        // float32 length = u.Normalize();
        const length = this.m_u.Normalize();
        // float32 C = length - m_length;
        let C = length - this.m_length;
        C = b2Clamp(C, -b2_maxLinearCorrection, b2_maxLinearCorrection);
        const impulse = -this.m_mass * C;
        // b2Vec2 P = impulse * u;
        const P = b2Vec2.MulSV(impulse, u, b2DistanceJoint.SolvePositionConstraints_s_P);
        // cA -= m_invMassA * P;
        cA.SelfMulSub(this.m_invMassA, P);
        // aA -= m_invIA * b2Cross(rA, P);
        aA -= this.m_invIA * b2Vec2.CrossVV(rA, P);
        // cB += m_invMassB * P;
        cB.SelfMulAdd(this.m_invMassB, P);
        // aB += m_invIB * b2Cross(rB, P);
        aB += this.m_invIB * b2Vec2.CrossVV(rB, P);
        // data.positions[this.m_indexA].c = cA;
        data.positions[this.m_indexA].a = aA;
        // data.positions[this.m_indexB].c = cB;
        data.positions[this.m_indexB].a = aB;
        return b2Abs(C) < b2_linearSlop;
    }
}
b2DistanceJoint.InitVelocityConstraints_s_P = new b2Vec2();
b2DistanceJoint.SolveVelocityConstraints_s_vpA = new b2Vec2();
b2DistanceJoint.SolveVelocityConstraints_s_vpB = new b2Vec2();
b2DistanceJoint.SolveVelocityConstraints_s_P = new b2Vec2();
b2DistanceJoint.SolvePositionConstraints_s_P = new b2Vec2();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYjJEaXN0YW5jZUpvaW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2R5bmFtaWNzL2pvaW50cy9iMkRpc3RhbmNlSm9pbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7R0FnQkc7QUFFSCxPQUFPLEVBQUUsYUFBYSxFQUFFLHNCQUFzQixFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNoRyxPQUFPLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFNLE1BQU0scUJBQXFCLENBQUM7QUFDeEUsT0FBTyxFQUFlLE9BQU8sRUFBRSxVQUFVLEVBQWUsTUFBTSxXQUFXLENBQUM7QUFZMUUsd0RBQXdEO0FBQ3hELDhEQUE4RDtBQUM5RCwyREFBMkQ7QUFDM0QsZ0VBQWdFO0FBQ2hFLHdEQUF3RDtBQUN4RCwrQ0FBK0M7QUFDL0MsTUFBTSxPQUFPLGtCQUFtQixTQUFRLFVBQVU7SUFPaEQ7UUFDRSxLQUFLLHlCQUE2QixDQUFDO1FBUDVCLGlCQUFZLEdBQVcsSUFBSSxNQUFNLEVBQUUsQ0FBQztRQUNwQyxpQkFBWSxHQUFXLElBQUksTUFBTSxFQUFFLENBQUM7UUFDN0MsV0FBTSxHQUFHLENBQUMsQ0FBQztRQUNYLGdCQUFXLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLGlCQUFZLEdBQUcsQ0FBQyxDQUFDO0lBSWpCLENBQUM7SUFFRCxVQUFVLENBQUMsRUFBVSxFQUFFLEVBQVUsRUFBRSxPQUFXLEVBQUUsT0FBVztRQUN6RCxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUNoQixJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUNoQixJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFD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Q0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDckMsd0NBQXdDO1FBQ3hDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7UUFFckMsT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsYUFBYSxDQUFDO0lBQ2xDLENBQUM7O0FBaE5jLDJDQUEyQixHQUFHLElBQUksTUFBTSxFQUFFLENBQUM7QUE2RzNDLDhDQUE4QixHQUFHLElBQUksTUFBTSxFQUFFLENBQUM7QUFDOUMsOENBQThCLEdBQUcsSUFBSSxNQUFNLEVBQUUsQ0FBQztBQUM5Qyw0Q0FBNEIsR0FBRyxJQUFJLE1BQU0sRUFBRSxDQUFDO0FBOEM1Qyw0Q0FBNEIsR0FBRyxJQUFJLE1BQU0sRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQ29weXJpZ2h0IChjKSAyMDA2LTIwMDcgRXJpbiBDYXR0byBodHRwOi8vd3d3LmJveDJkLm9yZ1xyXG4gKlxyXG4gKiBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZFxyXG4gKiB3YXJyYW50eS4gIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzXHJcbiAqIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuXHJcbiAqIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLFxyXG4gKiBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0XHJcbiAqIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczpcclxuICogMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3RcclxuICogY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmVcclxuICogaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlXHJcbiAqIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuXHJcbiAqIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlXHJcbiAqIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS5cclxuICogMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi5cclxuICovXHJcblxyXG5pbXBvcnQgeyBiMl9saW5lYXJTbG9wLCBiMl9tYXhMaW5lYXJDb3JyZWN0aW9uLCBiMl9waSwgYjJNYXliZSB9IGZyb20gJy4uLy4uL2NvbW1vbi9iMlNldHRpbmdzJztcclxuaW1wb3J0IHsgYjJBYnMsIGIyQ2xhbXAsIGIyUm90LCBiMlZlYzIsIFhZIH0gZnJvbSAnLi4vLi4vY29tbW9uL2IyTWF0aCc7XHJcbmltcG9ydCB7IGIySUpvaW50RGVmLCBiMkpvaW50LCBiMkpvaW50RGVmLCBiMkpvaW50VHlwZSB9IGZyb20gJy4vYjJKb2ludCc7XHJcbmltcG9ydCB7IGIyU29sdmVyRGF0YSB9IGZyb20gJy4uL2IyVGltZVN0ZXAnO1xyXG5pbXBvcnQgeyBiMkJvZHkgfSBmcm9tICcuLi9iMkJvZHknO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBiMklEaXN0YW5jZUpvaW50RGVmIGV4dGVuZHMgYjJJSm9pbnREZWYge1xyXG4gIGxvY2FsQW5jaG9yQTogWFk7XHJcbiAgbG9jYWxBbmNob3JCOiBYWTtcclxuICBsZW5ndGg6IG51bWJlcjtcclxuICBmcmVxdWVuY3lIej86IG51bWJlcjtcclxuICBkYW1waW5nUmF0aW8/OiBudW1iZXI7XHJcbn1cclxuXHJcbi8vLyBEaXN0YW5jZSBqb2ludCBkZWZpbml0aW9uLiBUaGlzIHJlcXVpcmVzIGRlZmluaW5nIGFuXHJcbi8vLyBhbmNob3IgcG9pbnQgb24gYm90aCBib2RpZXMgYW5kIHRoZSBub24temVybyBsZW5ndGggb2YgdGhlXHJcbi8vLyBkaXN0YW5jZSBqb2ludC4gVGhlIGRlZmluaXRpb24gdXNlcyBsb2NhbCBhbmNob3IgcG9pbnRzXHJcbi8vLyBzbyB0aGF0IHRoZSBpbml0aWFsIGNvbmZpZ3VyYXRpb24gY2FuIHZpb2xhdGUgdGhlIGNvbnN0cmFpbnRcclxuLy8vIHNsaWdodGx5LiBUaGlzIGhlbHBzIHdoZW4gc2F2aW5nIGFuZCBsb2FkaW5nIGEgZ2FtZS5cclxuLy8vIEB3YXJuaW5nIERvIG5vdCB1c2UgYSB6ZXJvIG9yIHNob3J0IGxlbmd0aC5cclxuZXhwb3J0IGNsYXNzIGIyRGlzdGFuY2VKb2ludERlZiBleHRlbmRzIGIySm9pbnREZWYgaW1wbGVtZW50cyBiMklEaXN0YW5jZUpvaW50RGVmIHtcclxuICByZWFkb25seSBsb2NhbEFuY2hvckE6IGIyVmVjMiA9IG5ldyBiMlZlYzIoKTtcclxuICByZWFkb25seSBsb2NhbEFuY2hvckI6IGIyVmVjMiA9IG5ldyBiMlZlYzIoKTtcclxuICBsZW5ndGggPSAxO1xyXG4gIGZyZXF1ZW5jeUh6ID0gMDtcclxuICBkYW1waW5nUmF0aW8gPSAwO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKGIySm9pbnRUeXBlLmVfZGlzdGFuY2VKb2ludCk7XHJcbiAgfVxyXG5cclxuICBJbml0aWFsaXplKGIxOiBiMkJvZHksIGIyOiBiMkJvZHksIGFuY2hvcjE6IFhZLCBhbmNob3IyOiBYWSk6IHZvaWQge1xyXG4gICAgdGhpcy5ib2R5QSA9IGIxO1xyXG4gICAgdGhpcy5ib2R5QiA9IGIyO1xyXG4gICAgdGhpcy5ib2R5QS5HZXRMb2NhbFBvaW50KGFuY2hvcjEsIHRoaXMubG9jYWxBbmNob3JBKTtcclxuICAgIHRoaXMuYm9keUIuR2V0TG9jYWxQb2ludChhbmNob3IyLCB0aGlzLmxvY2FsQW5jaG9yQik7XHJcbiAgICB0aGlzLmxlbmd0aCA9IGIyVmVjMi5EaXN0YW5jZVZWKGFuY2hvcjEsIGFuY2hvcjIpO1xyXG4gICAgdGhpcy5mcmVxdWVuY3lIeiA9IDA7XHJcbiAgICB0aGlzLmRhbXBpbmdSYXRpbyA9IDA7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgYjJEaXN0YW5jZUpvaW50IGV4dGVuZHMgYjJKb2ludCB7XHJcbiAgbV9mcmVxdWVuY3lIeiA9IDA7XHJcbiAgbV9kYW1waW5nUmF0aW8gPSAwO1xyXG4gIG1fYmlhcyA9IDA7XHJcblxyXG4gIC8vIFNvbHZlciBzaGFyZWRcclxuICByZWFkb25seSBtX2xvY2FsQW5jaG9yQTogYjJWZWMyID0gbmV3IGIyVmVjMigpO1xyXG4gIHJlYWRvbmx5IG1fbG9jYWxBbmNob3JCOiBiMlZlYzIgPSBuZXcgYjJWZWMyKCk7XHJcbiAgbV9nYW1tYSA9IDA7XHJcbiAgbV9pbXB1bHNlID0gMDtcclxuICBtX2xlbmd0aCA9IDA7XHJcblxyXG4gIC8vIFNvbHZlciB0ZW1wXHJcbiAgbV9pbmRleEEgPSAwO1xyXG4gIG1faW5kZXhCID0gMDtcclxuICByZWFkb25seSBtX3U6IGIyVmVjMiA9IG5ldyBiMlZlYzIoKTtcclxuICByZWFkb25seSBtX3JBOiBiMlZlYzIgPSBuZXcgYjJWZWMyKCk7XHJcbiAgcmVhZG9ubHkgbV9yQjogYjJWZWMyID0gbmV3IGIyVmVjMigpO1xyXG4gIHJlYWRvbmx5IG1fbG9jYWxDZW50ZXJBOiBiMlZlYzIgPSBuZXcgYjJWZWMyKCk7XHJcbiAgcmVhZG9ubHkgbV9sb2NhbENlbnRlckI6IGIyVmVjMiA9IG5ldyBiMlZlYzIoKTtcclxuICBtX2ludk1hc3NBID0gMDtcclxuICBtX2ludk1hc3NCID0gMDtcclxuICBtX2ludklBID0gMDtcclxuICBtX2ludklCID0gMDtcclxuICBtX21hc3MgPSAwO1xyXG5cclxuICByZWFkb25seSBtX3FBOiBiMlJvdCA9IG5ldyBiMlJvdCgpO1xyXG4gIHJlYWRvbmx5IG1fcUI6IGIyUm90ID0gbmV3IGIyUm90KCk7XHJcbiAgcmVhZG9ubHkgbV9sYWxjQTogYjJWZWMyID0gbmV3IGIyVmVjMigpO1xyXG4gIHJlYWRvbmx5IG1fbGFsY0I6IGIyVmVjMiA9IG5ldyBiMlZlYzIoKTtcclxuXHJcbiAgY29uc3RydWN0b3IoZGVmOiBiMklEaXN0YW5jZUpvaW50RGVmKSB7XHJcbiAgICBzdXBlcihkZWYpO1xyXG5cclxuICAgIHRoaXMubV9mcmVxdWVuY3lIeiA9IGIyTWF5YmUoZGVmLmZyZXF1ZW5jeUh6LCAwKTtcclxuICAgIHRoaXMubV9kYW1waW5nUmF0aW8gPSBiMk1heWJlKGRlZi5kYW1waW5nUmF0aW8sIDApO1xyXG5cclxuICAgIHRoaXMubV9sb2NhbEFuY2hvckEuQ29weShkZWYubG9jYWxBbmNob3JBKTtcclxuICAgIHRoaXMubV9sb2NhbEFuY2hvckIuQ29weShkZWYubG9jYWxBbmNob3JCKTtcclxuICAgIHRoaXMubV9sZW5ndGggPSBkZWYubGVuZ3RoO1xyXG4gIH1cclxuXHJcbiAgR2V0QW5jaG9yQTxUIGV4dGVuZHMgWFk+KG91dDogVCk6IFQge1xyXG4gICAgcmV0dXJuIHRoaXMubV9ib2R5QS5HZXRXb3JsZFBvaW50KHRoaXMubV9sb2NhbEFuY2hvckEsIG91dCk7XHJcbiAgfVxyXG5cclxuICBHZXRBbmNob3JCPFQgZXh0ZW5kcyBYWT4ob3V0OiBUKTogVCB7XHJcbiAgICByZXR1cm4gdGhpcy5tX2JvZHlCLkdldFdvcmxkUG9pbnQodGhpcy5tX2xvY2FsQW5jaG9yQiwgb3V0KTtcclxuICB9XHJcblxyXG4gIEdldFJlYWN0aW9uRm9yY2U8VCBleHRlbmRzIFhZPihpbnZfZHQ6IG51bWJlciwgb3V0OiBUKTogVCB7XHJcbiAgICBvdXQueCA9IGludl9kdCAqIHRoaXMubV9pbXB1bHNlICogdGhpcy5tX3UueDtcclxuICAgIG91dC55ID0gaW52X2R0ICogdGhpcy5tX2ltcHVsc2UgKiB0aGlzLm1fdS55O1xyXG4gICAgcmV0dXJuIG91dDtcclxuICB9XHJcblxyXG4gIEdldFJlYWN0aW9uVG9ycXVlKGludl9kdDogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxuXHJcbiAgR2V0TG9jYWxBbmNob3JBKCk6IFJlYWRvbmx5PGIyVmVjMj4ge1xyXG4gICAgcmV0dXJuIHRoaXMubV9sb2NhbEFuY2hvckE7XHJcbiAgfVxyXG5cclxuICBHZXRMb2NhbEFuY2hvckIoKTogUmVhZG9ubHk8YjJWZWMyPiB7XHJcbiAgICByZXR1cm4gdGhpcy5tX2xvY2FsQW5jaG9yQjtcclxuICB9XHJcblxyXG4gIFNldExlbmd0aChsZW5ndGg6IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy5tX2xlbmd0aCA9IGxlbmd0aDtcclxuICB9XHJcblxyXG4gIExlbmd0aCgpIHtcclxuICAgIHJldHVybiB0aGlzLm1fbGVuZ3RoO1xyXG4gIH1cclxuXHJcbiAgU2V0RnJlcXVlbmN5KGh6OiBudW1iZXIpOiB2b2lkIHtcclxuICAgIHRoaXMubV9mcmVxdWVuY3lIeiA9IGh6O1xyXG4gIH1cclxuXHJcbiAgR2V0RnJlcXVlbmN5KCkge1xyXG4gICAgcmV0dXJuIHRoaXMubV9mcmVxdWVuY3lIejtcclxuICB9XHJcblxyXG4gIFNldERhbXBpbmdSYXRpbyhyYXRpbzogbnVtYmVyKTogdm9pZCB7XHJcbiAgICB0aGlzLm1fZGFtcGluZ1JhdGlvID0gcmF0aW87XHJcbiAgfVxyXG5cclxuICBHZXREYW1waW5nUmF0aW8oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5tX2RhbXBpbmdSYXRpbztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIEluaXRWZWxvY2l0eUNvbnN0cmFpbnRzX3NfUCA9IG5ldyBiMlZlYzIoKTtcclxuXHJcbiAgSW5pdFZlbG9jaXR5Q29uc3RyYWludHMoZGF0YTogYjJTb2x2ZXJEYXRhKTogdm9pZCB7XHJcbiAgICB0aGlzLm1faW5kZXhBID0gdGhpcy5tX2JvZHlBLm1faXNsYW5kSW5kZXg7XHJcbiAgICB0aGlzLm1faW5kZXhCID0gdGhpcy5tX2JvZHlCLm1faXNsYW5kSW5kZXg7XHJcbiAgICB0aGlzLm1fbG9jYWxDZW50ZXJBLkNvcHkodGhpcy5tX2JvZHlBLm1fc3dlZXAubG9jYWxDZW50ZXIpO1xyXG4gICAgdGhpcy5tX2xvY2FsQ2VudGVyQi5Db3B5KHRoaXMubV9ib2R5Qi5tX3N3ZWVwLmxvY2FsQ2VudGVyKTtcclxuICAgIHRoaXMubV9pbnZNYXNzQSA9IHRoaXMubV9ib2R5QS5tX2ludk1hc3M7XHJcbiAgICB0aGlzLm1faW52TWFzc0IgPSB0aGlzLm1fYm9keUIubV9pbnZNYXNzO1xyXG4gICAgdGhpcy5tX2ludklBID0gdGhpcy5tX2JvZHlBLm1faW52STtcclxuICAgIHRoaXMubV9pbnZJQiA9IHRoaXMubV9ib2R5Qi5tX2ludkk7XHJcblxyXG4gICAgY29uc3QgY0E6IGIyVmVjMiA9IGRhdGEucG9zaXRpb25zW3RoaXMubV9pbmRleEFdLmM7XHJcbiAgICBjb25zdCBhQTogbnVtYmVyID0gZGF0YS5wb3NpdGlvbnNbdGhpcy5tX2luZGV4QV0uYTtcclxuICAgIGNvbnN0IHZBOiBiMlZlYzIgPSBkYXRhLnZlbG9jaXRpZXNbdGhpcy5tX2luZGV4QV0udjtcclxuICAgIGxldCB3QTogbnVtYmVyID0gZGF0YS52ZWxvY2l0aWVzW3RoaXMubV9pbmRleEFdLnc7XHJcblxyXG4gICAgY29uc3QgY0I6IGIyVmVjMiA9IGRhdGEucG9zaXRpb25zW3RoaXMubV9pbmRleEJdLmM7XHJcbiAgICBjb25zdCBhQjogbnVtYmVyID0gZGF0YS5wb3NpdGlvbnNbdGhpcy5tX2luZGV4Ql0uYTtcclxuICAgIGNvbnN0IHZCOiBiMlZlYzIgPSBkYXRhLnZlbG9jaXRpZXNbdGhpcy5tX2luZGV4Ql0udjtcclxuICAgIGxldCB3QjogbnVtYmVyID0gZGF0YS52ZWxvY2l0aWVzW3RoaXMubV9pbmRleEJdLnc7XHJcblxyXG4gICAgLy8gY29uc3QgcUE6IGIyUm90ID0gbmV3IGIyUm90KGFBKSwgcUI6IGIyUm90ID0gbmV3IGIyUm90KGFCKTtcclxuICAgIGNvbnN0IHFBOiBiMlJvdCA9IHRoaXMubV9xQS5TZXRBbmdsZShhQSksXHJcbiAgICAgIHFCOiBiMlJvdCA9IHRoaXMubV9xQi5TZXRBbmdsZShhQik7XHJcblxyXG4gICAgLy8gbV9yQSA9IGIyTXVsKHFBLCBtX2xvY2FsQW5jaG9yQSAtIG1fbG9jYWxDZW50ZXJBKTtcclxuICAgIGIyVmVjMi5TdWJWVih0aGlzLm1fbG9jYWxBbmNob3JBLCB0aGlzLm1fbG9jYWxDZW50ZXJBLCB0aGlzLm1fbGFsY0EpO1xyXG4gICAgYjJSb3QuTXVsUlYocUEsIHRoaXMubV9sYWxjQSwgdGhpcy5tX3JBKTtcclxuICAgIC8vIG1fckIgPSBiMk11bChxQiwgbV9sb2NhbEFuY2hvckIgLSBtX2xvY2FsQ2VudGVyQik7XHJcbiAgICBiMlZlYzIuU3ViVlYodGhpcy5tX2xvY2FsQW5jaG9yQiwgdGhpcy5tX2xvY2FsQ2VudGVyQiwgdGhpcy5tX2xhbGNCKTtcclxuICAgIGIyUm90Lk11bFJWKHFCLCB0aGlzLm1fbGFsY0IsIHRoaXMubV9yQik7XHJcbiAgICAvLyBtX3UgPSBjQiArIG1fckIgLSBjQSAtIG1fckE7XHJcbiAgICB0aGlzLm1fdS54ID0gY0IueCArIHRoaXMubV9yQi54IC0gY0EueCAtIHRoaXMubV9yQS54O1xyXG4gICAgdGhpcy5tX3UueSA9IGNCLnkgKyB0aGlzLm1fckIueSAtIGNBLnkgLSB0aGlzLm1fckEueTtcclxuXHJcbiAgICAvLyBIYW5kbGUgc2luZ3VsYXJpdHkuXHJcbiAgICBjb25zdCBsZW5ndGg6IG51bWJlciA9IHRoaXMubV91Lkxlbmd0aCgpO1xyXG4gICAgaWYgKGxlbmd0aCA+IGIyX2xpbmVhclNsb3ApIHtcclxuICAgICAgdGhpcy5tX3UuU2VsZk11bCgxIC8gbGVuZ3RoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMubV91LlNldFplcm8oKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBmbG9hdDMyIGNyQXUgPSBiMkNyb3NzKG1fckEsIG1fdSk7XHJcbiAgICBjb25zdCBjckF1OiBudW1iZXIgPSBiMlZlYzIuQ3Jvc3NWVih0aGlzLm1fckEsIHRoaXMubV91KTtcclxuICAgIC8vIGZsb2F0MzIgY3JCdSA9IGIyQ3Jvc3MobV9yQiwgbV91KTtcclxuICAgIGNvbnN0IGNyQnU6IG51bWJlciA9IGIyVmVjMi5Dcm9zc1ZWKHRoaXMubV9yQiwgdGhpcy5tX3UpO1xyXG4gICAgLy8gZmxvYXQzMiBpbnZNYXNzID0gbV9pbnZNYXNzQSArIG1faW52SUEgKiBjckF1ICogY3JBdSArIG1faW52TWFzc0IgKyBtX2ludklCICogY3JCdSAqIGNyQnU7XHJcbiAgICBsZXQgaW52TWFzczogbnVtYmVyID1cclxuICAgICAgdGhpcy5tX2ludk1hc3NBICsgdGhpcy5tX2ludklBICogY3JBdSAqIGNyQXUgKyB0aGlzLm1faW52TWFzc0IgKyB0aGlzLm1faW52SUIgKiBjckJ1ICogY3JCdTtcclxuXHJcbiAgICAvLyBDb21wdXRlIHRoZSBlZmZlY3RpdmUgbWFzcyBtYXRyaXguXHJcbiAgICB0aGlzLm1fbWFzcyA9IGludk1hc3MgIT09IDAgPyAxIC8gaW52TWFzcyA6IDA7XHJcblxyXG4gICAgaWYgKHRoaXMubV9mcmVxdWVuY3lIeiA+IDApIHtcclxuICAgICAgY29uc3QgQzogbnVtYmVyID0gbGVuZ3RoIC0gdGhpcy5tX2xlbmd0aDtcclxuXHJcbiAgICAgIC8vIEZyZXF1ZW5jeVxyXG4gICAgICBjb25zdCBvbWVnYTogbnVtYmVyID0gMiAqIGIyX3BpICogdGhpcy5tX2ZyZXF1ZW5jeUh6O1xyXG5cclxuICAgICAgLy8gRGFtcGluZyBjb2VmZmljaWVudFxyXG4gICAgICBjb25zdCBkOiBudW1iZXIgPSAyICogdGhpcy5tX21hc3MgKiB0aGlzLm1fZGFtcGluZ1JhdGlvICogb21lZ2E7XHJcblxyXG4gICAgICAvLyBTcHJpbmcgc3RpZmZuZXNzXHJcbiAgICAgIGNvbnN0IGs6IG51bWJlciA9IHRoaXMubV9tYXNzICogb21lZ2EgKiBvbWVnYTtcclxuXHJcbiAgICAgIC8vIG1hZ2ljIGZvcm11bGFzXHJcbiAgICAgIGNvbnN0IGg6IG51bWJlciA9IGRhdGEuc3RlcC5kdDtcclxuICAgICAgdGhpcy5tX2dhbW1hID0gaCAqIChkICsgaCAqIGspO1xyXG4gICAgICB0aGlzLm1fZ2FtbWEgPSB0aGlzLm1fZ2FtbWEgIT09IDAgPyAxIC8gdGhpcy5tX2dhbW1hIDogMDtcclxuICAgICAgdGhpcy5tX2JpYXMgPSBDICogaCAqIGsgKiB0aGlzLm1fZ2FtbWE7XHJcblxyXG4gICAgICBpbnZNYXNzICs9IHRoaXMubV9nYW1tYTtcclxuICAgICAgdGhpcy5tX21hc3MgPSBpbnZNYXNzICE9PSAwID8gMSAvIGludk1hc3MgOiAwO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5tX2dhbW1hID0gMDtcclxuICAgICAgdGhpcy5tX2JpYXMgPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChkYXRhLnN0ZXAud2FybVN0YXJ0aW5nKSB7XHJcbiAgICAgIC8vIFNjYWxlIHRoZSBpbXB1bHNlIHRvIHN1cHBvcnQgYSB2YXJpYWJsZSB0aW1lIHN0ZXAuXHJcbiAgICAgIHRoaXMubV9pbXB1bHNlICo9IGRhdGEuc3RlcC5kdFJhdGlvO1xyXG5cclxuICAgICAgLy8gYjJWZWMyIFAgPSBtX2ltcHVsc2UgKiBtX3U7XHJcbiAgICAgIGNvbnN0IFA6IGIyVmVjMiA9IGIyVmVjMi5NdWxTVihcclxuICAgICAgICB0aGlzLm1faW1wdWxzZSxcclxuICAgICAgICB0aGlzLm1fdSxcclxuICAgICAgICBiMkRpc3RhbmNlSm9pbnQuSW5pdFZlbG9jaXR5Q29uc3RyYWludHNfc19QLFxyXG4gICAgICApO1xyXG5cclxuICAgICAgLy8gdkEgLT0gbV9pbnZNYXNzQSAqIFA7XHJcbiAgICAgIHZBLlNlbGZNdWxTdWIodGhpcy5tX2ludk1hc3NBLCBQKTtcclxuICAgICAgLy8gd0EgLT0gbV9pbnZJQSAqIGIyQ3Jvc3MobV9yQSwgUCk7XHJcbiAgICAgIHdBIC09IHRoaXMubV9pbnZJQSAqIGIyVmVjMi5Dcm9zc1ZWKHRoaXMubV9yQSwgUCk7XHJcbiAgICAgIC8vIHZCICs9IG1faW52TWFzc0IgKiBQO1xyXG4gICAgICB2Qi5TZWxmTXVsQWRkKHRoaXMubV9pbnZNYXNzQiwgUCk7XHJcbiAgICAgIC8vIHdCICs9IG1faW52SUIgKiBiMkNyb3NzKG1fckIsIFApO1xyXG4gICAgICB3QiArPSB0aGlzLm1faW52SUIgKiBiMlZlYzIuQ3Jvc3NWVih0aGlzLm1fckIsIFApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5tX2ltcHVsc2UgPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGRhdGEudmVsb2NpdGllc1t0aGlzLm1faW5kZXhBXS52ID0gdkE7XHJcbiAgICBkYXRhLnZlbG9jaXRpZXNbdGhpcy5tX2luZGV4QV0udyA9IHdBO1xyXG4gICAgLy8gZGF0YS52ZWxvY2l0aWVzW3RoaXMubV9pbmRleEJdLnYgPSB2QjtcclxuICAgIGRhdGEudmVsb2NpdGllc1t0aGlzLm1faW5kZXhCXS53ID0gd0I7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyBTb2x2ZVZlbG9jaXR5Q29uc3RyYWludHNfc192cEEgPSBuZXcgYjJWZWMyKCk7XHJcbiAgcHJpdmF0ZSBzdGF0aWMgU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzX3NfdnBCID0gbmV3IGIyVmVjMigpO1xyXG4gIHByaXZhdGUgc3RhdGljIFNvbHZlVmVsb2NpdHlDb25zdHJhaW50c19zX1AgPSBuZXcgYjJWZWMyKCk7XHJcblxyXG4gIFNvbHZlVmVsb2NpdHlDb25zdHJhaW50cyhkYXRhOiBiMlNvbHZlckRhdGEpOiB2b2lkIHtcclxuICAgIGNvbnN0IHZBOiBiMlZlYzIgPSBkYXRhLnZlbG9jaXRpZXNbdGhpcy5tX2luZGV4QV0udjtcclxuICAgIGxldCB3QTogbnVtYmVyID0gZGF0YS52ZWxvY2l0aWVzW3RoaXMubV9pbmRleEFdLnc7XHJcbiAgICBjb25zdCB2QjogYjJWZWMyID0gZGF0YS52ZWxvY2l0aWVzW3RoaXMubV9pbmRleEJdLnY7XHJcbiAgICBsZXQgd0I6IG51bWJlciA9IGRhdGEudmVsb2NpdGllc1t0aGlzLm1faW5kZXhCXS53O1xyXG5cclxuICAgIC8vIGIyVmVjMiB2cEEgPSB2QSArIGIyQ3Jvc3Mod0EsIG1fckEpO1xyXG4gICAgY29uc3QgdnBBOiBiMlZlYzIgPSBiMlZlYzIuQWRkVkNyb3NzU1YoXHJcbiAgICAgIHZBLFxyXG4gICAgICB3QSxcclxuICAgICAgdGhpcy5tX3JBLFxyXG4gICAgICBiMkRpc3RhbmNlSm9pbnQuU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzX3NfdnBBLFxyXG4gICAgKTtcclxuICAgIC8vIGIyVmVjMiB2cEIgPSB2QiArIGIyQ3Jvc3Mod0IsIG1fckIpO1xyXG4gICAgY29uc3QgdnBCOiBiMlZlYzIgPSBiMlZlYzIuQWRkVkNyb3NzU1YoXHJcbiAgICAgIHZCLFxyXG4gICAgICB3QixcclxuICAgICAgdGhpcy5tX3JCLFxyXG4gICAgICBiMkRpc3RhbmNlSm9pbnQuU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzX3NfdnBCLFxyXG4gICAgKTtcclxuICAgIC8vIGZsb2F0MzIgQ2RvdCA9IGIyRG90KG1fdSwgdnBCIC0gdnBBKTtcclxuICAgIGNvbnN0IENkb3Q6IG51bWJlciA9IGIyVmVjMi5Eb3RWVih0aGlzLm1fdSwgYjJWZWMyLlN1YlZWKHZwQiwgdnBBLCBiMlZlYzIuc190MCkpO1xyXG5cclxuICAgIGNvbnN0IGltcHVsc2U6IG51bWJlciA9IC10aGlzLm1fbWFzcyAqIChDZG90ICsgdGhpcy5tX2JpYXMgKyB0aGlzLm1fZ2FtbWEgKiB0aGlzLm1faW1wdWxzZSk7XHJcbiAgICB0aGlzLm1faW1wdWxzZSArPSBpbXB1bHNlO1xyXG5cclxuICAgIC8vIGIyVmVjMiBQID0gaW1wdWxzZSAqIG1fdTtcclxuICAgIGNvbnN0IFA6IGIyVmVjMiA9IGIyVmVjMi5NdWxTVihpbXB1bHNlLCB0aGlzLm1fdSwgYjJEaXN0YW5jZUpvaW50LlNvbHZlVmVsb2NpdHlDb25zdHJhaW50c19zX1ApO1xyXG5cclxuICAgIC8vIHZBIC09IG1faW52TWFzc0EgKiBQO1xyXG4gICAgdkEuU2VsZk11bFN1Yih0aGlzLm1faW52TWFzc0EsIFApO1xyXG4gICAgLy8gd0EgLT0gbV9pbnZJQSAqIGIyQ3Jvc3MobV9yQSwgUCk7XHJcbiAgICB3QSAtPSB0aGlzLm1faW52SUEgKiBiMlZlYzIuQ3Jvc3NWVih0aGlzLm1fckEsIFApO1xyXG4gICAgLy8gdkIgKz0gbV9pbnZNYXNzQiAqIFA7XHJcbiAgICB2Qi5TZWxmTXVsQWRkKHRoaXMubV9pbnZNYXNzQiwgUCk7XHJcbiAgICAvLyB3QiArPSBtX2ludklCICogYjJDcm9zcyhtX3JCLCBQKTtcclxuICAgIHdCICs9IHRoaXMubV9pbnZJQiAqIGIyVmVjMi5Dcm9zc1ZWKHRoaXMubV9yQiwgUCk7XHJcblxyXG4gICAgLy8gZGF0YS52ZWxvY2l0aWVzW3RoaXMubV9pbmRleEFdLnYgPSB2QTtcclxuICAgIGRhdGEudmVsb2NpdGllc1t0aGlzLm1faW5kZXhBXS53ID0gd0E7XHJcbiAgICAvLyBkYXRhLnZlbG9jaXRpZXNbdGhpcy5tX2luZGV4Ql0udiA9IHZCO1xyXG4gICAgZGF0YS52ZWxvY2l0aWVzW3RoaXMubV9pbmRleEJdLncgPSB3QjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIFNvbHZlUG9zaXRpb25Db25zdHJhaW50c19zX1AgPSBuZXcgYjJWZWMyKCk7XHJcblxyXG4gIFNvbHZlUG9zaXRpb25Db25zdHJhaW50cyhkYXRhOiBiMlNvbHZlckRhdGEpOiBib29sZWFuIHtcclxuICAgIGlmICh0aGlzLm1fZnJlcXVlbmN5SHogPiAwKSB7XHJcbiAgICAgIC8vIFRoZXJlIGlzIG5vIHBvc2l0aW9uIGNvcnJlY3Rpb24gZm9yIHNvZnQgZGlzdGFuY2UgY29uc3RyYWludHMuXHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNBOiBiMlZlYzIgPSBkYXRhLnBvc2l0aW9uc1t0aGlzLm1faW5kZXhBXS5jO1xyXG4gICAgbGV0IGFBOiBudW1iZXIgPSBkYXRhLnBvc2l0aW9uc1t0aGlzLm1faW5kZXhBXS5hO1xyXG4gICAgY29uc3QgY0I6IGIyVmVjMiA9IGRhdGEucG9zaXRpb25zW3RoaXMubV9pbmRleEJdLmM7XHJcbiAgICBsZXQgYUI6IG51bWJlciA9IGRhdGEucG9zaXRpb25zW3RoaXMubV9pbmRleEJdLmE7XHJcblxyXG4gICAgLy8gY29uc3QgcUE6IGIyUm90ID0gbmV3IGIyUm90KGFBKSwgcUI6IGIyUm90ID0gbmV3IGIyUm90KGFCKTtcclxuICAgIGNvbnN0IHFBOiBiMlJvdCA9IHRoaXMubV9xQS5TZXRBbmdsZShhQSksXHJcbiAgICAgIHFCOiBiMlJvdCA9IHRoaXMubV9xQi5TZXRBbmdsZShhQik7XHJcblxyXG4gICAgLy8gYjJWZWMyIHJBID0gYjJNdWwocUEsIG1fbG9jYWxBbmNob3JBIC0gbV9sb2NhbENlbnRlckEpO1xyXG4gICAgY29uc3QgckE6IGIyVmVjMiA9IGIyUm90Lk11bFJWKHFBLCB0aGlzLm1fbGFsY0EsIHRoaXMubV9yQSk7IC8vIHVzZSBtX3JBXHJcbiAgICAvLyBiMlZlYzIgckIgPSBiMk11bChxQiwgbV9sb2NhbEFuY2hvckIgLSBtX2xvY2FsQ2VudGVyQik7XHJcbiAgICBjb25zdCByQjogYjJWZWMyID0gYjJSb3QuTXVsUlYocUIsIHRoaXMubV9sYWxjQiwgdGhpcy5tX3JCKTsgLy8gdXNlIG1fckJcclxuICAgIC8vIGIyVmVjMiB1ID0gY0IgKyByQiAtIGNBIC0gckE7XHJcbiAgICBjb25zdCB1OiBiMlZlYzIgPSB0aGlzLm1fdTsgLy8gdXNlIG1fdVxyXG4gICAgdS54ID0gY0IueCArIHJCLnggLSBjQS54IC0gckEueDtcclxuICAgIHUueSA9IGNCLnkgKyByQi55IC0gY0EueSAtIHJBLnk7XHJcblxyXG4gICAgLy8gZmxvYXQzMiBsZW5ndGggPSB1Lk5vcm1hbGl6ZSgpO1xyXG4gICAgY29uc3QgbGVuZ3RoOiBudW1iZXIgPSB0aGlzLm1fdS5Ob3JtYWxpemUoKTtcclxuICAgIC8vIGZsb2F0MzIgQyA9IGxlbmd0aCAtIG1fbGVuZ3RoO1xyXG4gICAgbGV0IEM6IG51bWJlciA9IGxlbmd0aCAtIHRoaXMubV9sZW5ndGg7XHJcbiAgICBDID0gYjJDbGFtcChDLCAtYjJfbWF4TGluZWFyQ29ycmVjdGlvbiwgYjJfbWF4TGluZWFyQ29ycmVjdGlvbik7XHJcblxyXG4gICAgY29uc3QgaW1wdWxzZTogbnVtYmVyID0gLXRoaXMubV9tYXNzICogQztcclxuICAgIC8vIGIyVmVjMiBQID0gaW1wdWxzZSAqIHU7XHJcbiAgICBjb25zdCBQOiBiMlZlYzIgPSBiMlZlYzIuTXVsU1YoaW1wdWxzZSwgdSwgYjJEaXN0YW5jZUpvaW50LlNvbHZlUG9zaXRpb25Db25zdHJhaW50c19zX1ApO1xyXG5cclxuICAgIC8vIGNBIC09IG1faW52TWFzc0EgKiBQO1xyXG4gICAgY0EuU2VsZk11bFN1Yih0aGlzLm1faW52TWFzc0EsIFApO1xyXG4gICAgLy8gYUEgLT0gbV9pbnZJQSAqIGIyQ3Jvc3MockEsIFApO1xyXG4gICAgYUEgLT0gdGhpcy5tX2ludklBICogYjJWZWMyLkNyb3NzVlYockEsIFApO1xyXG4gICAgLy8gY0IgKz0gbV9pbnZNYXNzQiAqIFA7XHJcbiAgICBjQi5TZWxmTXVsQWRkKHRoaXMubV9pbnZNYXNzQiwgUCk7XHJcbiAgICAvLyBhQiArPSBtX2ludklCICogYjJDcm9zcyhyQiwgUCk7XHJcbiAgICBhQiArPSB0aGlzLm1faW52SUIgKiBiMlZlYzIuQ3Jvc3NWVihyQiwgUCk7XHJcblxyXG4gICAgLy8gZGF0YS5wb3NpdGlvbnNbdGhpcy5tX2luZGV4QV0uYyA9IGNBO1xyXG4gICAgZGF0YS5wb3NpdGlvbnNbdGhpcy5tX2luZGV4QV0uYSA9IGFBO1xyXG4gICAgLy8gZGF0YS5wb3NpdGlvbnNbdGhpcy5tX2luZGV4Ql0uYyA9IGNCO1xyXG4gICAgZGF0YS5wb3NpdGlvbnNbdGhpcy5tX2luZGV4Ql0uYSA9IGFCO1xyXG5cclxuICAgIHJldHVybiBiMkFicyhDKSA8IGIyX2xpbmVhclNsb3A7XHJcbiAgfVxyXG59XHJcbiJdfQ==