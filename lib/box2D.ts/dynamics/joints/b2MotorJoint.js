/*
 * Copyright (c) 2006-2012 Erin Catto http://www.box2d.org
 *
 * This software is provided 'as-is', without any express or implied
 * warranty.  In no event will the authors be held liable for any damages
 * arising from the use of this software.
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 * 1. The origin of this software must not be misrepresented; you must not
 * claim that you wrote the original software. If you use this software
 * in a product, an acknowledgment in the product documentation would be
 * appreciated but is not required.
 * 2. Altered source versions must be plainly marked as such, and must not be
 * misrepresented as being the original software.
 * 3. This notice may not be removed or altered from any source distribution.
 */
import { b2Assert, b2Maybe } from '../../common/b2Settings';
import { b2Clamp, b2IsValid, b2Mat22, b2Rot, b2Vec2 } from '../../common/b2Math';
import { b2Joint, b2JointDef } from './b2Joint';
export class b2MotorJointDef extends b2JointDef {
    constructor() {
        super(11 /* e_motorJoint */);
        this.linearOffset = new b2Vec2(0, 0);
        this.angularOffset = 0;
        this.maxForce = 1;
        this.maxTorque = 1;
        this.correctionFactor = 0.3;
    }
    Initialize(bA, bB) {
        this.bodyA = bA;
        this.bodyB = bB;
        // b2Vec2 xB = bodyB->GetPosition();
        // linearOffset = bodyA->GetLocalPoint(xB);
        this.bodyA.GetLocalPoint(this.bodyB.GetPosition(), this.linearOffset);
        const angleA = this.bodyA.GetAngle();
        const angleB = this.bodyB.GetAngle();
        this.angularOffset = angleB - angleA;
    }
}
export class b2MotorJoint extends b2Joint {
    constructor(def) {
        super(def);
        // Solver shared
        this.m_linearOffset = new b2Vec2();
        this.m_angularOffset = 0;
        this.m_linearImpulse = new b2Vec2();
        this.m_angularImpulse = 0;
        this.m_maxForce = 0;
        this.m_maxTorque = 0;
        this.m_correctionFactor = 0.3;
        // Solver temp
        this.m_indexA = 0;
        this.m_indexB = 0;
        this.m_rA = new b2Vec2();
        this.m_rB = new b2Vec2();
        this.m_localCenterA = new b2Vec2();
        this.m_localCenterB = new b2Vec2();
        this.m_linearError = new b2Vec2();
        this.m_angularError = 0;
        this.m_invMassA = 0;
        this.m_invMassB = 0;
        this.m_invIA = 0;
        this.m_invIB = 0;
        this.m_linearMass = new b2Mat22();
        this.m_angularMass = 0;
        this.m_qA = new b2Rot();
        this.m_qB = new b2Rot();
        this.m_K = new b2Mat22();
        this.m_linearOffset.Copy(b2Maybe(def.linearOffset, b2Vec2.ZERO));
        this.m_linearImpulse.SetZero();
        this.m_maxForce = b2Maybe(def.maxForce, 0);
        this.m_maxTorque = b2Maybe(def.maxTorque, 0);
        this.m_correctionFactor = b2Maybe(def.correctionFactor, 0.3);
    }
    GetAnchorA(out) {
        const pos = this.m_bodyA.GetPosition();
        out.x = pos.x;
        out.y = pos.y;
        return out;
    }
    GetAnchorB(out) {
        const pos = this.m_bodyB.GetPosition();
        out.x = pos.x;
        out.y = pos.y;
        return out;
    }
    GetReactionForce(inv_dt, out) {
        // return inv_dt * m_linearImpulse;
        return b2Vec2.MulSV(inv_dt, this.m_linearImpulse, out);
    }
    GetReactionTorque(inv_dt) {
        return inv_dt * this.m_angularImpulse;
    }
    SetLinearOffset(linearOffset) {
        if (!b2Vec2.IsEqualToV(linearOffset, this.m_linearOffset)) {
            this.m_bodyA.SetAwake(true);
            this.m_bodyB.SetAwake(true);
            this.m_linearOffset.Copy(linearOffset);
        }
    }
    GetLinearOffset() {
        return this.m_linearOffset;
    }
    SetAngularOffset(angularOffset) {
        if (angularOffset !== this.m_angularOffset) {
            this.m_bodyA.SetAwake(true);
            this.m_bodyB.SetAwake(true);
            this.m_angularOffset = angularOffset;
        }
    }
    GetAngularOffset() {
        return this.m_angularOffset;
    }
    SetMaxForce(force) {
        !!B2_DEBUG && b2Assert(b2IsValid(force) && force >= 0);
        this.m_maxForce = force;
    }
    GetMaxForce() {
        return this.m_maxForce;
    }
    SetMaxTorque(torque) {
        !!B2_DEBUG && b2Assert(b2IsValid(torque) && torque >= 0);
        this.m_maxTorque = torque;
    }
    GetMaxTorque() {
        return this.m_maxTorque;
    }
    InitVelocityConstraints(data) {
        this.m_indexA = this.m_bodyA.m_islandIndex;
        this.m_indexB = this.m_bodyB.m_islandIndex;
        this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);
        this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);
        this.m_invMassA = this.m_bodyA.m_invMass;
        this.m_invMassB = this.m_bodyB.m_invMass;
        this.m_invIA = this.m_bodyA.m_invI;
        this.m_invIB = this.m_bodyB.m_invI;
        const cA = data.positions[this.m_indexA].c;
        const aA = data.positions[this.m_indexA].a;
        const vA = data.velocities[this.m_indexA].v;
        let wA = data.velocities[this.m_indexA].w;
        const cB = data.positions[this.m_indexB].c;
        const aB = data.positions[this.m_indexB].a;
        const vB = data.velocities[this.m_indexB].v;
        let wB = data.velocities[this.m_indexB].w;
        const qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);
        // Compute the effective mass matrix.
        // this.m_rA = b2Mul(qA, m_linearOffset - this.m_localCenterA);
        const rA = b2Rot.MulRV(qA, b2Vec2.SubVV(this.m_linearOffset, this.m_localCenterA, b2Vec2.s_t0), this.m_rA);
        // this.m_rB = b2Mul(qB, -this.m_localCenterB);
        const rB = b2Rot.MulRV(qB, b2Vec2.NegV(this.m_localCenterB, b2Vec2.s_t0), this.m_rB);
        // J = [-I -r1_skew I r2_skew]
        // r_skew = [-ry; rx]
        // Matlab
        // K = [ mA+r1y^2*iA+mB+r2y^2*iB,  -r1y*iA*r1x-r2y*iB*r2x,          -r1y*iA-r2y*iB]
        //     [  -r1y*iA*r1x-r2y*iB*r2x, mA+r1x^2*iA+mB+r2x^2*iB,           r1x*iA+r2x*iB]
        //     [          -r1y*iA-r2y*iB,           r1x*iA+r2x*iB,                   iA+iB]
        const mA = this.m_invMassA, mB = this.m_invMassB;
        const iA = this.m_invIA, iB = this.m_invIB;
        // Upper 2 by 2 of K for point to point
        const K = this.m_K;
        K.ex.x = mA + mB + iA * rA.y * rA.y + iB * rB.y * rB.y;
        K.ex.y = -iA * rA.x * rA.y - iB * rB.x * rB.y;
        K.ey.x = K.ex.y;
        K.ey.y = mA + mB + iA * rA.x * rA.x + iB * rB.x * rB.x;
        // this.m_linearMass = K.GetInverse();
        K.GetInverse(this.m_linearMass);
        this.m_angularMass = iA + iB;
        if (this.m_angularMass > 0) {
            this.m_angularMass = 1 / this.m_angularMass;
        }
        // this.m_linearError = cB + rB - cA - rA;
        b2Vec2.SubVV(b2Vec2.AddVV(cB, rB, b2Vec2.s_t0), b2Vec2.AddVV(cA, rA, b2Vec2.s_t1), this.m_linearError);
        this.m_angularError = aB - aA - this.m_angularOffset;
        if (data.step.warmStarting) {
            // Scale impulses to support a variable time step.
            // this.m_linearImpulse *= data.step.dtRatio;
            this.m_linearImpulse.SelfMul(data.step.dtRatio);
            this.m_angularImpulse *= data.step.dtRatio;
            // b2Vec2 P(this.m_linearImpulse.x, this.m_linearImpulse.y);
            const P = this.m_linearImpulse;
            // vA -= mA * P;
            vA.SelfMulSub(mA, P);
            wA -= iA * (b2Vec2.CrossVV(rA, P) + this.m_angularImpulse);
            // vB += mB * P;
            vB.SelfMulAdd(mB, P);
            wB += iB * (b2Vec2.CrossVV(rB, P) + this.m_angularImpulse);
        }
        else {
            this.m_linearImpulse.SetZero();
            this.m_angularImpulse = 0;
        }
        // data.velocities[this.m_indexA].v = vA; // vA is a reference
        data.velocities[this.m_indexA].w = wA;
        // data.velocities[this.m_indexB].v = vB; // vB is a reference
        data.velocities[this.m_indexB].w = wB;
    }
    SolveVelocityConstraints(data) {
        const vA = data.velocities[this.m_indexA].v;
        let wA = data.velocities[this.m_indexA].w;
        const vB = data.velocities[this.m_indexB].v;
        let wB = data.velocities[this.m_indexB].w;
        const mA = this.m_invMassA, mB = this.m_invMassB;
        const iA = this.m_invIA, iB = this.m_invIB;
        const h = data.step.dt;
        const inv_h = data.step.inv_dt;
        // Solve angular friction
        {
            const Cdot = wB - wA + inv_h * this.m_correctionFactor * this.m_angularError;
            let impulse = -this.m_angularMass * Cdot;
            const oldImpulse = this.m_angularImpulse;
            const maxImpulse = h * this.m_maxTorque;
            this.m_angularImpulse = b2Clamp(this.m_angularImpulse + impulse, -maxImpulse, maxImpulse);
            impulse = this.m_angularImpulse - oldImpulse;
            wA -= iA * impulse;
            wB += iB * impulse;
        }
        // Solve linear friction
        {
            const rA = this.m_rA;
            const rB = this.m_rB;
            // b2Vec2 Cdot = vB + b2Vec2.CrossSV(wB, rB) - vA - b2Vec2.CrossSV(wA, rA) + inv_h * this.m_correctionFactor * this.m_linearError;
            const Cdot_v2 = b2Vec2.AddVV(b2Vec2.SubVV(b2Vec2.AddVV(vB, b2Vec2.CrossSV(wB, rB, b2Vec2.s_t0), b2Vec2.s_t0), b2Vec2.AddVV(vA, b2Vec2.CrossSV(wA, rA, b2Vec2.s_t1), b2Vec2.s_t1), b2Vec2.s_t2), b2Vec2.MulSV(inv_h * this.m_correctionFactor, this.m_linearError, b2Vec2.s_t3), b2MotorJoint.SolveVelocityConstraints_s_Cdot_v2);
            // b2Vec2 impulse = -b2Mul(this.m_linearMass, Cdot);
            const impulse_v2 = b2Mat22
                .MulMV(this.m_linearMass, Cdot_v2, b2MotorJoint.SolveVelocityConstraints_s_impulse_v2)
                .SelfNeg();
            // b2Vec2 oldImpulse = this.m_linearImpulse;
            const oldImpulse_v2 = b2MotorJoint.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);
            // this.m_linearImpulse += impulse;
            this.m_linearImpulse.SelfAdd(impulse_v2);
            const maxImpulse = h * this.m_maxForce;
            if (this.m_linearImpulse.LengthSquared() > maxImpulse * maxImpulse) {
                this.m_linearImpulse.Normalize();
                // this.m_linearImpulse *= maxImpulse;
                this.m_linearImpulse.SelfMul(maxImpulse);
            }
            // impulse = this.m_linearImpulse - oldImpulse;
            b2Vec2.SubVV(this.m_linearImpulse, oldImpulse_v2, impulse_v2);
            // vA -= mA * impulse;
            vA.SelfMulSub(mA, impulse_v2);
            // wA -= iA * b2Vec2.CrossVV(rA, impulse);
            wA -= iA * b2Vec2.CrossVV(rA, impulse_v2);
            // vB += mB * impulse;
            vB.SelfMulAdd(mB, impulse_v2);
            // wB += iB * b2Vec2.CrossVV(rB, impulse);
            wB += iB * b2Vec2.CrossVV(rB, impulse_v2);
        }
        // data.velocities[this.m_indexA].v = vA; // vA is a reference
        data.velocities[this.m_indexA].w = wA;
        // data.velocities[this.m_indexB].v = vB; // vB is a reference
        data.velocities[this.m_indexB].w = wB;
    }
    SolvePositionConstraints(data) {
        return true;
    }
}
b2MotorJoint.SolveVelocityConstraints_s_Cdot_v2 = new b2Vec2();
b2MotorJoint.SolveVelocityConstraints_s_impulse_v2 = new b2Vec2();
b2MotorJoint.SolveVelocityConstraints_s_oldImpulse_v2 = new b2Vec2();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYjJNb3RvckpvaW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2R5bmFtaWNzL2pvaW50cy9iMk1vdG9ySm9pbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7R0FnQkc7QUFFSCxPQUFPLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQzVELE9BQU8sRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFNLE1BQU0scUJBQXFCLENBQUM7QUFFckYsT0FBTyxFQUFlLE9BQU8sRUFBRSxVQUFVLEVBQWUsTUFBTSxXQUFXLENBQUM7QUE4QjFFLE1BQU0sT0FBTyxlQUFnQixTQUFRLFVBQVU7SUFXN0M7UUFDRSxLQUFLLHVCQUEwQixDQUFDO1FBWHpCLGlCQUFZLEdBQVcsSUFBSSxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRWpELGtCQUFhLEdBQUcsQ0FBQyxDQUFDO1FBRWxCLGFBQVEsR0FBRyxDQUFDLENBQUM7UUFFYixjQUFTLEdBQUcsQ0FBQyxDQUFDO1FBRWQscUJBQWdCLEdBQUcsR0FBRyxDQUFDO0lBSXZCLENBQUM7SUFFRCxVQUFVLENBQUMsRUFBVSxFQUFFLEVBQVU7UUFDL0IsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDaEIsb0NBQW9DO1FBQ3BDLDJDQUEyQztRQUMzQyxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUV0RSxNQUFNLE1BQU0sR0FBVyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzdDLE1BQU0sTUFBTSxHQUFXLElBQUksQ0FBQyxLQUFL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LFVBQVUsQ0FBQyxFQUFFLEVBQUUsVUFBVSxDQUFDLENBQUM7WUFDOUIsMENBQTBDO1lBQzFDLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsVUFBVSxDQUFDLENBQUM7U0FDM0M7UUFFRCw4REFBOEQ7UUFDOUQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUN0Qyw4REFBOEQ7UUFDOUQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUN4QyxDQUFDO0lBRUQsd0JBQXdCLENBQUMsSUFBa0I7UUFDekMsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDOztBQXpGYywrQ0FBa0MsR0FBRyxJQUFJLE1BQU0sRUFBRSxDQUFDO0FBQ2xELGtEQUFxQyxHQUFHLElBQUksTUFBTSxFQUFFLENBQUM7QUFDckQscURBQXdDLEdBQUcsSUFBSSxNQUFNLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIENvcHlyaWdodCAoYykgMjAwNi0yMDEyIEVyaW4gQ2F0dG8gaHR0cDovL3d3dy5ib3gyZC5vcmdcclxuICpcclxuICogVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWRcclxuICogd2FycmFudHkuICBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlc1xyXG4gKiBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLlxyXG4gKiBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSxcclxuICogaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdFxyXG4gKiBmcmVlbHksIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyByZXN0cmljdGlvbnM6XHJcbiAqIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90XHJcbiAqIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlXHJcbiAqIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZVxyXG4gKiBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLlxyXG4gKiAyLiBBbHRlcmVkIHNvdXJjZSB2ZXJzaW9ucyBtdXN0IGJlIHBsYWlubHkgbWFya2VkIGFzIHN1Y2gsIGFuZCBtdXN0IG5vdCBiZVxyXG4gKiBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuXHJcbiAqIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgYjJBc3NlcnQsIGIyTWF5YmUgfSBmcm9tICcuLi8uLi9jb21tb24vYjJTZXR0aW5ncyc7XHJcbmltcG9ydCB7IGIyQ2xhbXAsIGIySXNWYWxpZCwgYjJNYXQyMiwgYjJSb3QsIGIyVmVjMiwgWFkgfSBmcm9tICcuLi8uLi9jb21tb24vYjJNYXRoJztcclxuaW1wb3J0IHsgYjJCb2R5IH0gZnJvbSAnLi4vYjJCb2R5JztcclxuaW1wb3J0IHsgYjJJSm9pbnREZWYsIGIySm9pbnQsIGIySm9pbnREZWYsIGIySm9pbnRUeXBlIH0gZnJvbSAnLi9iMkpvaW50JztcclxuaW1wb3J0IHsgYjJTb2x2ZXJEYXRhIH0gZnJvbSAnLi4vYjJUaW1lU3RlcCc7XHJcblxyXG4vLyBQb2ludC10by1wb2ludCBjb25zdHJhaW50XHJcbi8vIENkb3QgPSB2MiAtIHYxXHJcbi8vICAgICAgPSB2MiArIGNyb3NzKHcyLCByMikgLSB2MSAtIGNyb3NzKHcxLCByMSlcclxuLy8gSiA9IFstSSAtcjFfc2tldyBJIHIyX3NrZXcgXVxyXG4vLyBJZGVudGl0eSB1c2VkOlxyXG4vLyB3IGsgJSAocnggaSArIHJ5IGopID0gdyAqICgtcnkgaSArIHJ4IGopXHJcbi8vXHJcbi8vIHIxID0gb2Zmc2V0IC0gYzFcclxuLy8gcjIgPSAtYzJcclxuXHJcbi8vIEFuZ2xlIGNvbnN0cmFpbnRcclxuLy8gQ2RvdCA9IHcyIC0gdzFcclxuLy8gSiA9IFswIDAgLTEgMCAwIDFdXHJcbi8vIEsgPSBpbnZJMSArIGludkkyXHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIGIySU1vdG9ySm9pbnREZWYgZXh0ZW5kcyBiMklKb2ludERlZiB7XHJcbiAgbGluZWFyT2Zmc2V0PzogWFk7XHJcblxyXG4gIGFuZ3VsYXJPZmZzZXQ/OiBudW1iZXI7XHJcblxyXG4gIG1heEZvcmNlPzogbnVtYmVyO1xyXG5cclxuICBtYXhUb3JxdWU/OiBudW1iZXI7XHJcblxyXG4gIGNvcnJlY3Rpb25GYWN0b3I/OiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBiMk1vdG9ySm9pbnREZWYgZXh0ZW5kcyBiMkpvaW50RGVmIGltcGxlbWVudHMgYjJJTW90b3JKb2ludERlZiB7XHJcbiAgcmVhZG9ubHkgbGluZWFyT2Zmc2V0OiBiMlZlYzIgPSBuZXcgYjJWZWMyKDAsIDApO1xyXG5cclxuICBhbmd1bGFyT2Zmc2V0ID0gMDtcclxuXHJcbiAgbWF4Rm9yY2UgPSAxO1xyXG5cclxuICBtYXhUb3JxdWUgPSAxO1xyXG5cclxuICBjb3JyZWN0aW9uRmFjdG9yID0gMC4zO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKGIySm9pbnRUeXBlLmVfbW90b3JKb2ludCk7XHJcbiAgfVxyXG5cclxuICBJbml0aWFsaXplKGJBOiBiMkJvZHksIGJCOiBiMkJvZHkpOiB2b2lkIHtcclxuICAgIHRoaXMuYm9keUEgPSBiQTtcclxuICAgIHRoaXMuYm9keUIgPSBiQjtcclxuICAgIC8vIGIyVmVjMiB4QiA9IGJvZHlCLT5HZXRQb3NpdGlvbigpO1xyXG4gICAgLy8gbGluZWFyT2Zmc2V0ID0gYm9keUEtPkdldExvY2FsUG9pbnQoeEIpO1xyXG4gICAgdGhpcy5ib2R5QS5HZXRMb2NhbFBvaW50KHRoaXMuYm9keUIuR2V0UG9zaXRpb24oKSwgdGhpcy5saW5lYXJPZmZzZXQpO1xyXG5cclxuICAgIGNvbnN0IGFuZ2xlQTogbnVtYmVyID0gdGhpcy5ib2R5QS5HZXRBbmdsZSgpO1xyXG4gICAgY29uc3QgYW5nbGVCOiBudW1iZXIgPSB0aGlzLmJvZHlCLkdldEFuZ2xlKCk7XHJcbiAgICB0aGlzLmFuZ3VsYXJPZmZzZXQgPSBhbmdsZUIgLSBhbmdsZUE7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgYjJNb3RvckpvaW50IGV4dGVuZHMgYjJKb2ludCB7XHJcbiAgLy8gU29sdmVyIHNoYXJlZFxyXG4gIHJlYWRvbmx5IG1fbGluZWFyT2Zmc2V0OiBiMlZlYzIgPSBuZXcgYjJWZWMyKCk7XHJcbiAgbV9hbmd1bGFyT2Zmc2V0ID0gMDtcclxuICByZWFkb25seSBtX2xpbmVhckltcHVsc2U6IGIyVmVjMiA9IG5ldyBiMlZlYzIoKTtcclxuICBtX2FuZ3VsYXJJbXB1bHNlID0gMDtcclxuICBtX21heEZvcmNlID0gMDtcclxuICBtX21heFRvcnF1ZSA9IDA7XHJcbiAgbV9jb3JyZWN0aW9uRmFjdG9yID0gMC4zO1xyXG5cclxuICAvLyBTb2x2ZXIgdGVtcFxyXG4gIG1faW5kZXhBID0gMDtcclxuICBtX2luZGV4QiA9IDA7XHJcbiAgcmVhZG9ubHkgbV9yQTogYjJWZWMyID0gbmV3IGIyVmVjMigpO1xyXG4gIHJlYWRvbmx5IG1fckI6IGIyVmVjMiA9IG5ldyBiMlZlYzIoKTtcclxuICByZWFkb25seSBtX2xvY2FsQ2VudGVyQTogYjJWZWMyID0gbmV3IGIyVmVjMigpO1xyXG4gIHJlYWRvbmx5IG1fbG9jYWxDZW50ZXJCOiBiMlZlYzIgPSBuZXcgYjJWZWMyKCk7XHJcbiAgcmVhZG9ubHkgbV9saW5lYXJFcnJvcjogYjJWZWMyID0gbmV3IGIyVmVjMigpO1xyXG4gIG1fYW5ndWxhckVycm9yID0gMDtcclxuICBtX2ludk1hc3NBID0gMDtcclxuICBtX2ludk1hc3NCID0gMDtcclxuICBtX2ludklBID0gMDtcclxuICBtX2ludklCID0gMDtcclxuICByZWFkb25seSBtX2xpbmVhck1hc3M6IGIyTWF0MjIgPSBuZXcgYjJNYXQyMigpO1xyXG4gIG1fYW5ndWxhck1hc3MgPSAwO1xyXG5cclxuICByZWFkb25seSBtX3FBOiBiMlJvdCA9IG5ldyBiMlJvdCgpO1xyXG4gIHJlYWRvbmx5IG1fcUI6IGIyUm90ID0gbmV3IGIyUm90KCk7XHJcbiAgcmVhZG9ubHkgbV9LOiBiMk1hdDIyID0gbmV3IGIyTWF0MjIoKTtcclxuXHJcbiAgY29uc3RydWN0b3IoZGVmOiBiMklNb3RvckpvaW50RGVmKSB7XHJcbiAgICBzdXBlcihkZWYpO1xyXG5cclxuICAgIHRoaXMubV9saW5lYXJPZmZzZXQuQ29weShiMk1heWJlKGRlZi5saW5lYXJPZmZzZXQsIGIyVmVjMi5aRVJPKSk7XHJcbiAgICB0aGlzLm1fbGluZWFySW1wdWxzZS5TZXRaZXJvKCk7XHJcbiAgICB0aGlzLm1fbWF4Rm9yY2UgPSBiMk1heWJlKGRlZi5tYXhGb3JjZSwgMCk7XHJcbiAgICB0aGlzLm1fbWF4VG9ycXVlID0gYjJNYXliZShkZWYubWF4VG9ycXVlLCAwKTtcclxuICAgIHRoaXMubV9jb3JyZWN0aW9uRmFjdG9yID0gYjJNYXliZShkZWYuY29ycmVjdGlvbkZhY3RvciwgMC4zKTtcclxuICB9XHJcblxyXG4gIEdldEFuY2hvckE8VCBleHRlbmRzIFhZPihvdXQ6IFQpOiBUIHtcclxuICAgIGNvbnN0IHBvczogUmVhZG9ubHk8YjJWZWMyPiA9IHRoaXMubV9ib2R5QS5HZXRQb3NpdGlvbigpO1xyXG4gICAgb3V0LnggPSBwb3MueDtcclxuICAgIG91dC55ID0gcG9zLnk7XHJcbiAgICByZXR1cm4gb3V0O1xyXG4gIH1cclxuXHJcbiAgR2V0QW5jaG9yQjxUIGV4dGVuZHMgWFk+KG91dDogVCk6IFQge1xyXG4gICAgY29uc3QgcG9zOiBSZWFkb25seTxiMlZlYzI+ID0gdGhpcy5tX2JvZHlCLkdldFBvc2l0aW9uKCk7XHJcbiAgICBvdXQueCA9IHBvcy54O1xyXG4gICAgb3V0LnkgPSBwb3MueTtcclxuICAgIHJldHVybiBvdXQ7XHJcbiAgfVxyXG5cclxuICBHZXRSZWFjdGlvbkZvcmNlPFQgZXh0ZW5kcyBYWT4oaW52X2R0OiBudW1iZXIsIG91dDogVCk6IFQge1xyXG4gICAgLy8gcmV0dXJuIGludl9kdCAqIG1fbGluZWFySW1wdWxzZTtcclxuICAgIHJldHVybiBiMlZlYzIuTXVsU1YoaW52X2R0LCB0aGlzLm1fbGluZWFySW1wdWxzZSwgb3V0KTtcclxuICB9XHJcblxyXG4gIEdldFJlYWN0aW9uVG9ycXVlKGludl9kdDogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgIHJldHVybiBpbnZfZHQgKiB0aGlzLm1fYW5ndWxhckltcHVsc2U7XHJcbiAgfVxyXG5cclxuICBTZXRMaW5lYXJPZmZzZXQobGluZWFyT2Zmc2V0OiBiMlZlYzIpOiB2b2lkIHtcclxuICAgIGlmICghYjJWZWMyLklzRXF1YWxUb1YobGluZWFyT2Zmc2V0LCB0aGlzLm1fbGluZWFyT2Zmc2V0KSkge1xyXG4gICAgICB0aGlzLm1fYm9keUEuU2V0QXdha2UodHJ1ZSk7XHJcbiAgICAgIHRoaXMubV9ib2R5Qi5TZXRBd2FrZSh0cnVlKTtcclxuICAgICAgdGhpcy5tX2xpbmVhck9mZnNldC5Db3B5KGxpbmVhck9mZnNldCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBHZXRMaW5lYXJPZmZzZXQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5tX2xpbmVhck9mZnNldDtcclxuICB9XHJcblxyXG4gIFNldEFuZ3VsYXJPZmZzZXQoYW5ndWxhck9mZnNldDogbnVtYmVyKTogdm9pZCB7XHJcbiAgICBpZiAoYW5ndWxhck9mZnNldCAhPT0gdGhpcy5tX2FuZ3VsYXJPZmZzZXQpIHtcclxuICAgICAgdGhpcy5tX2JvZHlBLlNldEF3YWtlKHRydWUpO1xyXG4gICAgICB0aGlzLm1fYm9keUIuU2V0QXdha2UodHJ1ZSk7XHJcbiAgICAgIHRoaXMubV9hbmd1bGFyT2Zmc2V0ID0gYW5ndWxhck9mZnNldDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIEdldEFuZ3VsYXJPZmZzZXQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5tX2FuZ3VsYXJPZmZzZXQ7XHJcbiAgfVxyXG5cclxuICBTZXRNYXhGb3JjZShmb3JjZTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAhIUIyX0RFQlVHICYmIGIyQXNzZXJ0KGIySXNWYWxpZChmb3JjZSkgJiYgZm9yY2UgPj0gMCk7XHJcbiAgICB0aGlzLm1fbWF4Rm9yY2UgPSBmb3JjZTtcclxuICB9XHJcblxyXG4gIEdldE1heEZvcmNlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubV9tYXhGb3JjZTtcclxuICB9XHJcblxyXG4gIFNldE1heFRvcnF1ZSh0b3JxdWU6IG51bWJlcik6IHZvaWQge1xyXG4gICAgISFCMl9ERUJVRyAmJiBiMkFzc2VydChiMklzVmFsaWQodG9ycXVlKSAmJiB0b3JxdWUgPj0gMCk7XHJcbiAgICB0aGlzLm1fbWF4VG9ycXVlID0gdG9ycXVlO1xyXG4gIH1cclxuXHJcbiAgR2V0TWF4VG9ycXVlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubV9tYXhUb3JxdWU7XHJcbiAgfVxyXG5cclxuICBJbml0VmVsb2NpdHlDb25zdHJhaW50cyhkYXRhOiBiMlNvbHZlckRhdGEpOiB2b2lkIHtcclxuICAgIHRoaXMubV9pbmRleEEgPSB0aGlzLm1fYm9keUEubV9pc2xhbmRJbmRleDtcclxuICAgIHRoaXMubV9pbmRleEIgPSB0aGlzLm1fYm9keUIubV9pc2xhbmRJbmRleDtcclxuICAgIHRoaXMubV9sb2NhbENlbnRlckEuQ29weSh0aGlzLm1fYm9keUEubV9zd2VlcC5sb2NhbENlbnRlcik7XHJcbiAgICB0aGlzLm1fbG9jYWxDZW50ZXJCLkNvcHkodGhpcy5tX2JvZHlCLm1fc3dlZXAubG9jYWxDZW50ZXIpO1xyXG4gICAgdGhpcy5tX2ludk1hc3NBID0gdGhpcy5tX2JvZHlBLm1faW52TWFzcztcclxuICAgIHRoaXMubV9pbnZNYXNzQiA9IHRoaXMubV9ib2R5Qi5tX2ludk1hc3M7XHJcbiAgICB0aGlzLm1faW52SUEgPSB0aGlzLm1fYm9keUEubV9pbnZJO1xyXG4gICAgdGhpcy5tX2ludklCID0gdGhpcy5tX2JvZHlCLm1faW52STtcclxuXHJcbiAgICBjb25zdCBjQTogYjJWZWMyID0gZGF0YS5wb3NpdGlvbnNbdGhpcy5tX2luZGV4QV0uYztcclxuICAgIGNvbnN0IGFBOiBudW1iZXIgPSBkYXRhLnBvc2l0aW9uc1t0aGlzLm1faW5kZXhBXS5hO1xyXG4gICAgY29uc3QgdkE6IGIyVmVjMiA9IGRhdGEudmVsb2NpdGllc1t0aGlzLm1faW5kZXhBXS52O1xyXG4gICAgbGV0IHdBOiBudW1iZXIgPSBkYXRhLnZlbG9jaXRpZXNbdGhpcy5tX2luZGV4QV0udztcclxuXHJcbiAgICBjb25zdCBjQjogYjJWZWMyID0gZGF0YS5wb3NpdGlvbnNbdGhpcy5tX2luZGV4Ql0uYztcclxuICAgIGNvbnN0IGFCOiBudW1iZXIgPSBkYXRhLnBvc2l0aW9uc1t0aGlzLm1faW5kZXhCXS5hO1xyXG4gICAgY29uc3QgdkI6IGIyVmVjMiA9IGRhdGEudmVsb2NpdGllc1t0aGlzLm1faW5kZXhCXS52O1xyXG4gICAgbGV0IHdCOiBudW1iZXIgPSBkYXRhLnZlbG9jaXRpZXNbdGhpcy5tX2luZGV4Ql0udztcclxuXHJcbiAgICBjb25zdCBxQTogYjJSb3QgPSB0aGlzLm1fcUEuU2V0QW5nbGUoYUEpLFxyXG4gICAgICBxQjogYjJSb3QgPSB0aGlzLm1fcUIuU2V0QW5nbGUoYUIpO1xyXG5cclxuICAgIC8vIENvbXB1dGUgdGhlIGVmZmVjdGl2ZSBtYXNzIG1hdHJpeC5cclxuICAgIC8vIHRoaXMubV9yQSA9IGIyTXVsKHFBLCBtX2xpbmVhck9mZnNldCAtIHRoaXMubV9sb2NhbENlbnRlckEpO1xyXG4gICAgY29uc3QgckE6IGIyVmVjMiA9IGIyUm90Lk11bFJWKFxyXG4gICAgICBxQSxcclxuICAgICAgYjJWZWMyLlN1YlZWKHRoaXMubV9saW5lYXJPZmZzZXQsIHRoaXMubV9sb2NhbENlbnRlckEsIGIyVmVjMi5zX3QwKSxcclxuICAgICAgdGhpcy5tX3JBLFxyXG4gICAgKTtcclxuICAgIC8vIHRoaXMubV9yQiA9IGIyTXVsKHFCLCAtdGhpcy5tX2xvY2FsQ2VudGVyQik7XHJcbiAgICBjb25zdCByQjogYjJWZWMyID0gYjJSb3QuTXVsUlYocUIsIGIyVmVjMi5OZWdWKHRoaXMubV9sb2NhbENlbnRlckIsIGIyVmVjMi5zX3QwKSwgdGhpcy5tX3JCKTtcclxuXHJcbiAgICAvLyBKID0gWy1JIC1yMV9za2V3IEkgcjJfc2tld11cclxuICAgIC8vIHJfc2tldyA9IFstcnk7IHJ4XVxyXG5cclxuICAgIC8vIE1hdGxhYlxyXG4gICAgLy8gSyA9IFsgbUErcjF5XjIqaUErbUIrcjJ5XjIqaUIsICAtcjF5KmlBKnIxeC1yMnkqaUIqcjJ4LCAgICAgICAgICAtcjF5KmlBLXIyeSppQl1cclxuICAgIC8vICAgICBbICAtcjF5KmlBKnIxeC1yMnkqaUIqcjJ4LCBtQStyMXheMippQSttQityMnheMippQiwgICAgICAgICAgIHIxeCppQStyMngqaUJdXHJcbiAgICAvLyAgICAgWyAgICAgICAgICAtcjF5KmlBLXIyeSppQiwgICAgICAgICAgIHIxeCppQStyMngqaUIsICAgICAgICAgICAgICAgICAgIGlBK2lCXVxyXG5cclxuICAgIGNvbnN0IG1BOiBudW1iZXIgPSB0aGlzLm1faW52TWFzc0EsXHJcbiAgICAgIG1COiBudW1iZXIgPSB0aGlzLm1faW52TWFzc0I7XHJcbiAgICBjb25zdCBpQTogbnVtYmVyID0gdGhpcy5tX2ludklBLFxyXG4gICAgICBpQjogbnVtYmVyID0gdGhpcy5tX2ludklCO1xyXG5cclxuICAgIC8vIFVwcGVyIDIgYnkgMiBvZiBLIGZvciBwb2ludCB0byBwb2ludFxyXG4gICAgY29uc3QgSzogYjJNYXQyMiA9IHRoaXMubV9LO1xyXG4gICAgSy5leC54ID0gbUEgKyBtQiArIGlBICogckEueSAqIHJBLnkgKyBpQiAqIHJCLnkgKiByQi55O1xyXG4gICAgSy5leC55ID0gLWlBICogckEueCAqIHJBLnkgLSBpQiAqIHJCLnggKiByQi55O1xyXG4gICAgSy5leS54ID0gSy5leC55O1xyXG4gICAgSy5leS55ID0gbUEgKyBtQiArIGlBICogckEueCAqIHJBLnggKyBpQiAqIHJCLnggKiByQi54O1xyXG5cclxuICAgIC8vIHRoaXMubV9saW5lYXJNYXNzID0gSy5HZXRJbnZlcnNlKCk7XHJcbiAgICBLLkdldEludmVyc2UodGhpcy5tX2xpbmVhck1hc3MpO1xyXG5cclxuICAgIHRoaXMubV9hbmd1bGFyTWFzcyA9IGlBICsgaUI7XHJcbiAgICBpZiAodGhpcy5tX2FuZ3VsYXJNYXNzID4gMCkge1xyXG4gICAgICB0aGlzLm1fYW5ndWxhck1hc3MgPSAxIC8gdGhpcy5tX2FuZ3VsYXJNYXNzO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHRoaXMubV9saW5lYXJFcnJvciA9IGNCICsgckIgLSBjQSAtIHJBO1xyXG4gICAgYjJWZWMyLlN1YlZWKFxyXG4gICAgICBiMlZlYzIuQWRkVlYoY0IsIHJCLCBiMlZlYzIuc190MCksXHJcbiAgICAgIGIyVmVjMi5BZGRWVihjQSwgckEsIGIyVmVjMi5zX3QxKSxcclxuICAgICAgdGhpcy5tX2xpbmVhckVycm9yLFxyXG4gICAgKTtcclxuICAgIHRoaXMubV9hbmd1bGFyRXJyb3IgPSBhQiAtIGFBIC0gdGhpcy5tX2FuZ3VsYXJPZmZzZXQ7XHJcblxyXG4gICAgaWYgKGRhdGEuc3RlcC53YXJtU3RhcnRpbmcpIHtcclxuICAgICAgLy8gU2NhbGUgaW1wdWxzZXMgdG8gc3VwcG9ydCBhIHZhcmlhYmxlIHRpbWUgc3RlcC5cclxuICAgICAgLy8gdGhpcy5tX2xpbmVhckltcHVsc2UgKj0gZGF0YS5zdGVwLmR0UmF0aW87XHJcbiAgICAgIHRoaXMubV9saW5lYXJJbXB1bHNlLlNlbGZNdWwoZGF0YS5zdGVwLmR0UmF0aW8pO1xyXG4gICAgICB0aGlzLm1fYW5ndWxhckltcHVsc2UgKj0gZGF0YS5zdGVwLmR0UmF0aW87XHJcblxyXG4gICAgICAvLyBiMlZlYzIgUCh0aGlzLm1fbGluZWFySW1wdWxzZS54LCB0aGlzLm1fbGluZWFySW1wdWxzZS55KTtcclxuICAgICAgY29uc3QgUDogYjJWZWMyID0gdGhpcy5tX2xpbmVhckltcHVsc2U7XHJcbiAgICAgIC8vIHZBIC09IG1BICogUDtcclxuICAgICAgdkEuU2VsZk11bFN1YihtQSwgUCk7XHJcbiAgICAgIHdBIC09IGlBICogKGIyVmVjMi5Dcm9zc1ZWKHJBLCBQKSArIHRoaXMubV9hbmd1bGFySW1wdWxzZSk7XHJcbiAgICAgIC8vIHZCICs9IG1CICogUDtcclxuICAgICAgdkIuU2VsZk11bEFkZChtQiwgUCk7XHJcbiAgICAgIHdCICs9IGlCICogKGIyVmVjMi5Dcm9zc1ZWKHJCLCBQKSArIHRoaXMubV9hbmd1bGFySW1wdWxzZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1fbGluZWFySW1wdWxzZS5TZXRaZXJvKCk7XHJcbiAgICAgIHRoaXMubV9hbmd1bGFySW1wdWxzZSA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZGF0YS52ZWxvY2l0aWVzW3RoaXMubV9pbmRleEFdLnYgPSB2QTsgLy8gdkEgaXMgYSByZWZlcmVuY2VcclxuICAgIGRhdGEudmVsb2NpdGllc1t0aGlzLm1faW5kZXhBXS53ID0gd0E7XHJcbiAgICAvLyBkYXRhLnZlbG9jaXRpZXNbdGhpcy5tX2luZGV4Ql0udiA9IHZCOyAvLyB2QiBpcyBhIHJlZmVyZW5jZVxyXG4gICAgZGF0YS52ZWxvY2l0aWVzW3RoaXMubV9pbmRleEJdLncgPSB3QjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIFNvbHZlVmVsb2NpdHlDb25zdHJhaW50c19zX0Nkb3RfdjIgPSBuZXcgYjJWZWMyKCk7XHJcbiAgcHJpdmF0ZSBzdGF0aWMgU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzX3NfaW1wdWxzZV92MiA9IG5ldyBiMlZlYzIoKTtcclxuICBwcml2YXRlIHN0YXRpYyBTb2x2ZVZlbG9jaXR5Q29uc3RyYWludHNfc19vbGRJbXB1bHNlX3YyID0gbmV3IGIyVmVjMigpO1xyXG5cclxuICBTb2x2ZVZlbG9jaXR5Q29uc3RyYWludHMoZGF0YTogYjJTb2x2ZXJEYXRhKTogdm9pZCB7XHJcbiAgICBjb25zdCB2QTogYjJWZWMyID0gZGF0YS52ZWxvY2l0aWVzW3RoaXMubV9pbmRleEFdLnY7XHJcbiAgICBsZXQgd0E6IG51bWJlciA9IGRhdGEudmVsb2NpdGllc1t0aGlzLm1faW5kZXhBXS53O1xyXG4gICAgY29uc3QgdkI6IGIyVmVjMiA9IGRhdGEudmVsb2NpdGllc1t0aGlzLm1faW5kZXhCXS52O1xyXG4gICAgbGV0IHdCOiBudW1iZXIgPSBkYXRhLnZlbG9jaXRpZXNbdGhpcy5tX2luZGV4Ql0udztcclxuXHJcbiAgICBjb25zdCBtQTogbnVtYmVyID0gdGhpcy5tX2ludk1hc3NBLFxyXG4gICAgICBtQjogbnVtYmVyID0gdGhpcy5tX2ludk1hc3NCO1xyXG4gICAgY29uc3QgaUE6IG51bWJlciA9IHRoaXMubV9pbnZJQSxcclxuICAgICAgaUI6IG51bWJlciA9IHRoaXMubV9pbnZJQjtcclxuXHJcbiAgICBjb25zdCBoOiBudW1iZXIgPSBkYXRhLnN0ZXAuZHQ7XHJcbiAgICBjb25zdCBpbnZfaDogbnVtYmVyID0gZGF0YS5zdGVwLmludl9kdDtcclxuXHJcbiAgICAvLyBTb2x2ZSBhbmd1bGFyIGZyaWN0aW9uXHJcbiAgICB7XHJcbiAgICAgIGNvbnN0IENkb3Q6IG51bWJlciA9IHdCIC0gd0EgKyBpbnZfaCAqIHRoaXMubV9jb3JyZWN0aW9uRmFjdG9yICogdGhpcy5tX2FuZ3VsYXJFcnJvcjtcclxuICAgICAgbGV0IGltcHVsc2U6IG51bWJlciA9IC10aGlzLm1fYW5ndWxhck1hc3MgKiBDZG90O1xyXG5cclxuICAgICAgY29uc3Qgb2xkSW1wdWxzZTogbnVtYmVyID0gdGhpcy5tX2FuZ3VsYXJJbXB1bHNlO1xyXG4gICAgICBjb25zdCBtYXhJbXB1bHNlOiBudW1iZXIgPSBoICogdGhpcy5tX21heFRvcnF1ZTtcclxuICAgICAgdGhpcy5tX2FuZ3VsYXJJbXB1bHNlID0gYjJDbGFtcCh0aGlzLm1fYW5ndWxhckltcHVsc2UgKyBpbXB1bHNlLCAtbWF4SW1wdWxzZSwgbWF4SW1wdWxzZSk7XHJcbiAgICAgIGltcHVsc2UgPSB0aGlzLm1fYW5ndWxhckltcHVsc2UgLSBvbGRJbXB1bHNlO1xyXG5cclxuICAgICAgd0EgLT0gaUEgKiBpbXB1bHNlO1xyXG4gICAgICB3QiArPSBpQiAqIGltcHVsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU29sdmUgbGluZWFyIGZyaWN0aW9uXHJcbiAgICB7XHJcbiAgICAgIGNvbnN0IHJBID0gdGhpcy5tX3JBO1xyXG4gICAgICBjb25zdCByQiA9IHRoaXMubV9yQjtcclxuXHJcbiAgICAgIC8vIGIyVmVjMiBDZG90ID0gdkIgKyBiMlZlYzIuQ3Jvc3NTVih3QiwgckIpIC0gdkEgLSBiMlZlYzIuQ3Jvc3NTVih3QSwgckEpICsgaW52X2ggKiB0aGlzLm1fY29ycmVjdGlvbkZhY3RvciAqIHRoaXMubV9saW5lYXJFcnJvcjtcclxuICAgICAgY29uc3QgQ2RvdF92MiA9IGIyVmVjMi5BZGRWVihcclxuICAgICAgICBiMlZlYzIuU3ViVlYoXHJcbiAgICAgICAgICBiMlZlYzIuQWRkVlYodkIsIGIyVmVjMi5Dcm9zc1NWKHdCLCByQiwgYjJWZWMyLnNfdDApLCBiMlZlYzIuc190MCksXHJcbiAgICAgICAgICBiMlZlYzIuQWRkVlYodkEsIGIyVmVjMi5Dcm9zc1NWKHdBLCByQSwgYjJWZWMyLnNfdDEpLCBiMlZlYzIuc190MSksXHJcbiAgICAgICAgICBiMlZlYzIuc190MixcclxuICAgICAgICApLFxyXG4gICAgICAgIGIyVmVjMi5NdWxTVihpbnZfaCAqIHRoaXMubV9jb3JyZWN0aW9uRmFjdG9yLCB0aGlzLm1fbGluZWFyRXJyb3IsIGIyVmVjMi5zX3QzKSxcclxuICAgICAgICBiMk1vdG9ySm9pbnQuU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzX3NfQ2RvdF92MixcclxuICAgICAgKTtcclxuXHJcbiAgICAgIC8vIGIyVmVjMiBpbXB1bHNlID0gLWIyTXVsKHRoaXMubV9saW5lYXJNYXNzLCBDZG90KTtcclxuICAgICAgY29uc3QgaW1wdWxzZV92MjogYjJWZWMyID0gYjJNYXQyMlxyXG4gICAgICAgIC5NdWxNVih0aGlzLm1fbGluZWFyTWFzcywgQ2RvdF92MiwgYjJNb3RvckpvaW50LlNvbHZlVmVsb2NpdHlDb25zdHJhaW50c19zX2ltcHVsc2VfdjIpXHJcbiAgICAgICAgLlNlbGZOZWcoKTtcclxuICAgICAgLy8gYjJWZWMyIG9sZEltcHVsc2UgPSB0aGlzLm1fbGluZWFySW1wdWxzZTtcclxuICAgICAgY29uc3Qgb2xkSW1wdWxzZV92MiA9IGIyTW90b3JKb2ludC5Tb2x2ZVZlbG9jaXR5Q29uc3RyYWludHNfc19vbGRJbXB1bHNlX3YyLkNvcHkoXHJcbiAgICAgICAgdGhpcy5tX2xpbmVhckltcHVsc2UsXHJcbiAgICAgICk7XHJcbiAgICAgIC8vIHRoaXMubV9saW5lYXJJbXB1bHNlICs9IGltcHVsc2U7XHJcbiAgICAgIHRoaXMubV9saW5lYXJJbXB1bHNlLlNlbGZBZGQoaW1wdWxzZV92Mik7XHJcblxyXG4gICAgICBjb25zdCBtYXhJbXB1bHNlOiBudW1iZXIgPSBoICogdGhpcy5tX21heEZvcmNlO1xyXG5cclxuICAgICAgaWYgKHRoaXMubV9saW5lYXJJbXB1bHNlLkxlbmd0aFNxdWFyZWQoKSA+IG1heEltcHVsc2UgKiBtYXhJbXB1bHNlKSB7XHJcbiAgICAgICAgdGhpcy5tX2xpbmVhckltcHVsc2UuTm9ybWFsaXplKCk7XHJcbiAgICAgICAgLy8gdGhpcy5tX2xpbmVhckltcHVsc2UgKj0gbWF4SW1wdWxzZTtcclxuICAgICAgICB0aGlzLm1fbGluZWFySW1wdWxzZS5TZWxmTXVsKG1heEltcHVsc2UpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBpbXB1bHNlID0gdGhpcy5tX2xpbmVhckltcHVsc2UgLSBvbGRJbXB1bHNlO1xyXG4gICAgICBiMlZlYzIuU3ViVlYodGhpcy5tX2xpbmVhckltcHVsc2UsIG9sZEltcHVsc2VfdjIsIGltcHVsc2VfdjIpO1xyXG5cclxuICAgICAgLy8gdkEgLT0gbUEgKiBpbXB1bHNlO1xyXG4gICAgICB2QS5TZWxmTXVsU3ViKG1BLCBpbXB1bHNlX3YyKTtcclxuICAgICAgLy8gd0EgLT0gaUEgKiBiMlZlYzIuQ3Jvc3NWVihyQSwgaW1wdWxzZSk7XHJcbiAgICAgIHdBIC09IGlBICogYjJWZWMyLkNyb3NzVlYockEsIGltcHVsc2VfdjIpO1xyXG5cclxuICAgICAgLy8gdkIgKz0gbUIgKiBpbXB1bHNlO1xyXG4gICAgICB2Qi5TZWxmTXVsQWRkKG1CLCBpbXB1bHNlX3YyKTtcclxuICAgICAgLy8gd0IgKz0gaUIgKiBiMlZlYzIuQ3Jvc3NWVihyQiwgaW1wdWxzZSk7XHJcbiAgICAgIHdCICs9IGlCICogYjJWZWMyLkNyb3NzVlYockIsIGltcHVsc2VfdjIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGRhdGEudmVsb2NpdGllc1t0aGlzLm1faW5kZXhBXS52ID0gdkE7IC8vIHZBIGlzIGEgcmVmZXJlbmNlXHJcbiAgICBkYXRhLnZlbG9jaXRpZXNbdGhpcy5tX2luZGV4QV0udyA9IHdBO1xyXG4gICAgLy8gZGF0YS52ZWxvY2l0aWVzW3RoaXMubV9pbmRleEJdLnYgPSB2QjsgLy8gdkIgaXMgYSByZWZlcmVuY2VcclxuICAgIGRhdGEudmVsb2NpdGllc1t0aGlzLm1faW5kZXhCXS53ID0gd0I7XHJcbiAgfVxyXG5cclxuICBTb2x2ZVBvc2l0aW9uQ29uc3RyYWludHMoZGF0YTogYjJTb2x2ZXJEYXRhKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbn1cclxuIl19