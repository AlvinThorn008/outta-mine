/*
 * Copyright (c) 2006-2009 Erin Catto http://www.box2d.org
 *
 * This software is provided 'as-is', without any express or implied
 * warranty.  In no event will the authors be held liable for any damages
 * arising from the use of this software.
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 * 1. The origin of this software must not be misrepresented; you must not
 * claim that you wrote the original software. If you use this software
 * in a product, an acknowledgment in the product documentation would be
 * appreciated but is not required.
 * 2. Altered source versions must be plainly marked as such, and must not be
 * misrepresented as being the original software.
 * 3. This notice may not be removed or altered from any source distribution.
 */
import { b2_linearSlop, b2Assert } from '../../common/b2Settings';
import { b2Sqrt } from '../../common/b2Math';
import { b2Manifold, b2TestOverlapShape, } from '../../collision/b2Collision';
import { b2TimeOfImpact, b2TOIInput, b2TOIOutput } from '../../collision/b2TimeOfImpact';
import { b2CollideCircles, b2CollidePolygonAndCircle } from '../../collision/b2CollideCircle';
import { b2CollidePolygons } from '../../collision/b2CollidePolygon';
import { b2CollideEdgeAndCircle, b2CollideEdgeAndPolygon } from '../../collision/b2CollideEdge';
import { b2EdgeShape } from '../../collision/shapes/b2EdgeShape';
/// Friction mixing law. The idea is to allow either fixture to drive the friction to zero.
/// For example, anything slides on ice.
function b2MixFriction(friction1, friction2) {
    return b2Sqrt(friction1 * friction2);
}
/// Restitution mixing law. The idea is allow for anything to bounce off an inelastic surface.
/// For example, a superball bounces on anything.
function b2MixRestitution(restitution1, restitution2) {
    return restitution1 > restitution2 ? restitution1 : restitution2;
}
export class b2ContactEdge {
    constructor(contact) {
        this._other = null; ///< provides quick access to the other body attached.
        this.prev = null; ///< the previous contact edge in the body's contact list
        this.next = null; ///< the next contact edge in the body's contact list
        this.contact = contact;
    }
    Reset() {
        this._other = null;
        this.prev = null;
        this.next = null;
    }
    get other() {
        B2_ASSERT && b2Assert(this._other !== null);
        return this._other;
    }
    set other(value) {
        B2_ASSERT && b2Assert(this._other === null);
        this._other = value;
    }
}
const ComputeTOI_s_input = new b2TOIInput();
const ComputeTOI_s_output = new b2TOIOutput();
const Evaluate_s_edge = new b2EdgeShape();
const Evaluate = (contact) => {
    const xfA = contact.m_fixtureA.m_body.m_xf;
    const xfB = contact.m_fixtureB.m_body.m_xf;
    const typeA = contact.m_fixtureA._shapeType;
    const typeB = contact.m_fixtureB._shapeType;
    const shapeA = contact.m_fixtureA.m_shape;
    const shapeB = contact.m_fixtureB.m_shape;
    const manifold = contact.m_manifold;
    const indexA = contact.m_indexA;
    const pt = (typeA << 2) | typeB;
    if (pt === ((0 /* e_circleShape */ << 2) | 0 /* e_circleShape */)) {
        b2CollideCircles(manifold, shapeA, xfA, shapeB, xfB);
    }
    else if (pt === ((2 /* e_polygonShape */ << 2) | 0 /* e_circleShape */)) {
        b2CollidePolygonAndCircle(manifold, shapeA, xfA, shapeB, xfB);
    }
    else if (pt === ((2 /* e_polygonShape */ << 2) | 2 /* e_polygonShape */)) {
        b2CollidePolygons(manifold, shapeA, xfA, shapeB, xfB);
    }
    else if (pt === ((1 /* e_edgeShape */ << 2) | 0 /* e_circleShape */)) {
        b2CollideEdgeAndCircle(manifold, shapeA, xfA, shapeB, xfB);
    }
    else if (pt === ((1 /* e_edgeShape */ << 2) | 2 /* e_polygonShape */)) {
        b2CollideEdgeAndPolygon(manifold, shapeA, xfA, shapeB, xfB);
    }
    else if (pt === ((3 /* e_chainShape */ << 2) | 0 /* e_circleShape */)) {
        shapeA.GetChildEdge(Evaluate_s_edge, indexA);
        b2CollideEdgeAndCircle(manifold, Evaluate_s_edge, xfA, shapeB, xfB);
    }
    else if (pt === ((3 /* e_chainShape */ << 2) | 2 /* e_polygonShape */)) {
        shapeA.GetChildEdge(Evaluate_s_edge, indexA);
        b2CollideEdgeAndPolygon(manifold, Evaluate_s_edge, xfA, shapeB, xfB);
    }
};
export class b2Contact {
    constructor() {
        this.m_prev = null;
        this.m_next = null;
        this.m_nodeA = new b2ContactEdge(this);
        this.m_nodeB = new b2ContactEdge(this);
        this.m_fixtureA = null;
        this.m_fixtureB = null;
        this.m_indexA = 0;
        this.m_indexB = 0;
        this.m_manifold = new b2Manifold(); // TODO: readonly
        this.m_toiCount = 0;
        this.m_toi = NaN;
        this.m_friction = NaN;
        this.m_restitution = NaN;
        this.m_tangentSpeed = NaN;
        this.m_oldManifold = new b2Manifold(); // TODO: readonly
        this.m_islandFlag = false; /// Used when crawling contact graph when forming islands.
        this.m_touchingFlag = false; /// Set when the shapes are touching.
        this.m_enabledFlag = false; /// This contact can be disabled (by user)
        this.m_filterFlag = false; /// This contact needs filtering because a fixture filter was changed.
        this.m_bulletHitFlag = false; /// This bullet contact had a TOI event
        this.m_toiFlag = false; /// This contact has a valid TOI in m_toi
        this.m_toi = 0.0;
        this.m_friction = 0.0;
        this.m_restitution = 0.0;
        this.m_tangentSpeed = 0.0;
    }
    GetManifold() {
        return this.m_manifold;
    }
    GetWorldManifold(worldManifold) {
        worldManifold.Initialize(this.m_manifold, this.m_fixtureA.m_body.m_xf, this.m_fixtureA._shapeRadius, this.m_fixtureB.m_body.m_xf, this.m_fixtureB._shapeRadius);
    }
    IsTouching() {
        return this.m_touchingFlag;
    }
    SetEnabled(flag) {
        this.m_enabledFlag = flag;
    }
    IsEnabled() {
        return this.m_enabledFlag;
    }
    GetNext() {
        return this.m_next;
    }
    GetFixtureA() {
        return this.m_fixtureA;
    }
    GetChildIndexA() {
        return this.m_indexA;
    }
    GetShapeA() {
        return this.m_fixtureA.GetShape();
    }
    GetFixtureB() {
        return this.m_fixtureB;
    }
    GetChildIndexB() {
        return this.m_indexB;
    }
    GetShapeB() {
        return this.m_fixtureB.GetShape();
    }
    FlagForFiltering() {
        this.m_filterFlag = true;
    }
    SetFriction(friction) {
        this.m_friction = friction;
    }
    GetFriction() {
        return this.m_friction;
    }
    ResetFriction() {
        this.m_friction = b2MixFriction(this.m_fixtureA.m_friction, this.m_fixtureB.m_friction);
    }
    SetRestitution(restitution) {
        this.m_restitution = restitution;
    }
    GetRestitution() {
        return this.m_restitution;
    }
    ResetRestitution() {
        this.m_restitution = b2MixRestitution(this.m_fixtureA.m_restitution, this.m_fixtureB.m_restitution);
    }
    SetTangentSpeed(speed) {
        this.m_tangentSpeed = speed;
    }
    GetTangentSpeed() {
        return this.m_tangentSpeed;
    }
    Reset(fixtureA, indexA, fixtureB, indexB) {
        this.m_islandFlag = false;
        this.m_touchingFlag = false;
        this.m_enabledFlag = true;
        this.m_filterFlag = false;
        this.m_bulletHitFlag = false;
        this.m_toiFlag = false;
        this.m_fixtureA = fixtureA;
        this.m_fixtureB = fixtureB;
        this.m_indexA = indexA;
        this.m_indexB = indexB;
        this.m_manifold.pointCount = 0;
        this.m_prev = null;
        this.m_next = null;
        this.m_nodeA.Reset();
        this.m_nodeB.Reset();
        this.m_toiCount = 0;
        this.m_friction = b2MixFriction(this.m_fixtureA.m_friction, this.m_fixtureB.m_friction);
        this.m_restitution = b2MixRestitution(this.m_fixtureA.m_restitution, this.m_fixtureB.m_restitution);
    }
    Update(listener) {
        const tManifold = this.m_oldManifold;
        this.m_oldManifold = this.m_manifold;
        this.m_manifold = tManifold;
        // Re-enable this contact.
        this.m_enabledFlag = true;
        let touching = false;
        const wasTouching = this.m_touchingFlag;
        const sensorA = this.m_fixtureA.IsSensor();
        const sensorB = this.m_fixtureB.IsSensor();
        const sensor = sensorA || sensorB;
        const bodyA = this.m_fixtureA.GetBody();
        const bodyB = this.m_fixtureB.GetBody();
        const xfA = bodyA.GetTransform();
        const xfB = bodyB.GetTransform();
        const shapeA = this.GetShapeA();
        const shapeB = this.GetShapeB();
        // Is this contact a sensor?
        if (sensor) {
            touching = b2TestOverlapShape(shapeA, this.m_indexA, shapeB, this.m_indexB, xfA, xfB);
            // Sensors don't generate manifolds.
            this.m_manifold.pointCount = 0;
        }
        else {
            Evaluate(this);
            touching = this.m_manifold.pointCount > 0;
            // Match old contact ids to new contact ids and copy the
            // stored impulses to warm start the solver.
            for (let i = 0; i < this.m_manifold.pointCount; ++i) {
                const mp2 = this.m_manifold.points[i];
                mp2.normalImpulse = 0;
                mp2.tangentImpulse = 0;
                const id2 = mp2.id;
                for (let j = 0; j < this.m_oldManifold.pointCount; ++j) {
                    const mp1 = this.m_oldManifold.points[j];
                    if (mp1.id.key === id2.key) {
                        mp2.normalImpulse = mp1.normalImpulse;
                        mp2.tangentImpulse = mp1.tangentImpulse;
                        break;
                    }
                }
            }
            if (touching !== wasTouching) {
                bodyA.SetAwake(true);
                bodyB.SetAwake(true);
            }
        }
        this.m_touchingFlag = touching;
        if (!wasTouching && touching) {
            listener.BeginContact(this);
        }
        if (wasTouching && !touching) {
            listener.EndContact(this);
        }
        if (!sensor && touching) {
            listener.PreSolve(this, this.m_oldManifold);
        }
    }
    ComputeTOI(sweepA, sweepB) {
        const input = ComputeTOI_s_input;
        input.proxyA.SetShape(this.GetShapeA(), this.m_indexA);
        input.proxyB.SetShape(this.GetShapeB(), this.m_indexB);
        input.sweepA.Copy(sweepA);
        input.sweepB.Copy(sweepB);
        input.tMax = b2_linearSlop;
        const output = ComputeTOI_s_output;
        b2TimeOfImpact(output, input);
        return output.t;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYjJDb250YWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2R5bmFtaWNzL2NvbnRhY3RzL2IyQ29udGFjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7OztHQWdCRztBQUVILE9BQU8sRUFBRSxhQUFhLEVBQUUsUUFBUSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDbEUsT0FBTyxFQUFFLE1BQU0sRUFBVyxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFFTCxVQUFVLEVBRVYsa0JBQWtCLEdBRW5CLE1BQU0sNkJBQTZCLENBQUM7QUFDckMsT0FBTyxFQUFFLGNBQWMsRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFLekYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLHlCQUF5QixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFHOUYsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDckUsT0FBTyxFQUFFLHNCQUFzQixFQUFFLHVCQUF1QixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDaEcsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBR2pFLDJGQUEyRjtBQUMzRix3Q0FBd0M7QUFDeEMsU0FBUyxhQUFhLENBQUMsU0FBaUIsRUFBRSxTQUFpQjtJQUN6RCxPQUFPLE1BQU0sQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLENBQUM7QUFDdkMsQ0FBQztBQUVELDhGQUE4RjtBQUM5RixpREFBaUQ7QUFDakQsU0FBUyxnQkFBZ0IsQ0FBQyxZQUFvQixFQUFFLFlBQW9CO0lBQ2xFLE9BQU8sWUFBWSxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUM7QUFDbkUsQ0FBQztBQUVELE1BQU0sT0FBTyxhQUFhO0lBTXhCLFlBQVksT0FBa0I7UUFKdEIsV0FBTSxHQUFrQixJ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QUFDO1FBRTlCLE9BQU8sTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNsQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMDYtMjAwOSBFcmluIENhdHRvIGh0dHA6Ly93d3cuYm94MmQub3JnXHJcbiAqXHJcbiAqIFRoaXMgc29mdHdhcmUgaXMgcHJvdmlkZWQgJ2FzLWlzJywgd2l0aG91dCBhbnkgZXhwcmVzcyBvciBpbXBsaWVkXHJcbiAqIHdhcnJhbnR5LiAgSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXNcclxuICogYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS5cclxuICogUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsXHJcbiAqIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXRcclxuICogZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOlxyXG4gKiAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdFxyXG4gKiBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZVxyXG4gKiBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmVcclxuICogYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC5cclxuICogMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmVcclxuICogbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLlxyXG4gKiAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7IGIyX2xpbmVhclNsb3AsIGIyQXNzZXJ0IH0gZnJvbSAnLi4vLi4vY29tbW9uL2IyU2V0dGluZ3MnO1xyXG5pbXBvcnQgeyBiMlNxcnQsIGIyU3dlZXAgfSBmcm9tICcuLi8uLi9jb21tb24vYjJNYXRoJztcclxuaW1wb3J0IHtcclxuICBiMkNvbnRhY3RJRCxcclxuICBiMk1hbmlmb2xkLFxyXG4gIGIyTWFuaWZvbGRQb2ludCxcclxuICBiMlRlc3RPdmVybGFwU2hhcGUsXHJcbiAgYjJXb3JsZE1hbmlmb2xkLFxyXG59IGZyb20gJy4uLy4uL2NvbGxpc2lvbi9iMkNvbGxpc2lvbic7XHJcbmltcG9ydCB7IGIyVGltZU9mSW1wYWN0LCBiMlRPSUlucHV0LCBiMlRPSU91dHB1dCB9IGZyb20gJy4uLy4uL2NvbGxpc2lvbi9iMlRpbWVPZkltcGFjdCc7XHJcbmltcG9ydCB7IGIyQm9keSB9IGZyb20gJy4uL2IyQm9keSc7XHJcbmltcG9ydCB7IGIyRml4dHVyZSB9IGZyb20gJy4uL2IyRml4dHVyZSc7XHJcbmltcG9ydCB7IGIyU2hhcGUsIGIyU2hhcGVUeXBlIH0gZnJvbSAnLi4vLi4vY29sbGlzaW9uL3NoYXBlcy9iMlNoYXBlJztcclxuaW1wb3J0IHsgYjJDb250YWN0TGlzdGVuZXIgfSBmcm9tICcuLi9iMldvcmxkQ2FsbGJhY2tzJztcclxuaW1wb3J0IHsgYjJDb2xsaWRlQ2lyY2xlcywgYjJDb2xsaWRlUG9seWdvbkFuZENpcmNsZSB9IGZyb20gJy4uLy4uL2NvbGxpc2lvbi9iMkNvbGxpZGVDaXJjbGUnO1xyXG5pbXBvcnQgeyBiMkNpcmNsZVNoYXBlIH0gZnJvbSAnLi4vLi4vY29sbGlzaW9uL3NoYXBlcy9iMkNpcmNsZVNoYXBlJztcclxuaW1wb3J0IHsgYjJQb2x5Z29uU2hhcGUgfSBmcm9tICcuLi8uLi9jb2xsaXNpb24vc2hhcGVzL2IyUG9seWdvblNoYXBlJztcclxuaW1wb3J0IHsgYjJDb2xsaWRlUG9seWdvbnMgfSBmcm9tICcuLi8uLi9jb2xsaXNpb24vYjJDb2xsaWRlUG9seWdvbic7XHJcbmltcG9ydCB7IGIyQ29sbGlkZUVkZ2VBbmRDaXJjbGUsIGIyQ29sbGlkZUVkZ2VBbmRQb2x5Z29uIH0gZnJvbSAnLi4vLi4vY29sbGlzaW9uL2IyQ29sbGlkZUVkZ2UnO1xyXG5pbXBvcnQgeyBiMkVkZ2VTaGFwZSB9IGZyb20gJy4uLy4uL2NvbGxpc2lvbi9zaGFwZXMvYjJFZGdlU2hhcGUnO1xyXG5pbXBvcnQgeyBiMkNoYWluU2hhcGUgfSBmcm9tICcuLi8uLi9jb2xsaXNpb24vc2hhcGVzL2IyQ2hhaW5TaGFwZSc7XHJcblxyXG4vLy8gRnJpY3Rpb24gbWl4aW5nIGxhdy4gVGhlIGlkZWEgaXMgdG8gYWxsb3cgZWl0aGVyIGZpeHR1cmUgdG8gZHJpdmUgdGhlIGZyaWN0aW9uIHRvIHplcm8uXHJcbi8vLyBGb3IgZXhhbXBsZSwgYW55dGhpbmcgc2xpZGVzIG9uIGljZS5cclxuZnVuY3Rpb24gYjJNaXhGcmljdGlvbihmcmljdGlvbjE6IG51bWJlciwgZnJpY3Rpb24yOiBudW1iZXIpOiBudW1iZXIge1xyXG4gIHJldHVybiBiMlNxcnQoZnJpY3Rpb24xICogZnJpY3Rpb24yKTtcclxufVxyXG5cclxuLy8vIFJlc3RpdHV0aW9uIG1peGluZyBsYXcuIFRoZSBpZGVhIGlzIGFsbG93IGZvciBhbnl0aGluZyB0byBib3VuY2Ugb2ZmIGFuIGluZWxhc3RpYyBzdXJmYWNlLlxyXG4vLy8gRm9yIGV4YW1wbGUsIGEgc3VwZXJiYWxsIGJvdW5jZXMgb24gYW55dGhpbmcuXHJcbmZ1bmN0aW9uIGIyTWl4UmVzdGl0dXRpb24ocmVzdGl0dXRpb24xOiBudW1iZXIsIHJlc3RpdHV0aW9uMjogbnVtYmVyKTogbnVtYmVyIHtcclxuICByZXR1cm4gcmVzdGl0dXRpb24xID4gcmVzdGl0dXRpb24yID8gcmVzdGl0dXRpb24xIDogcmVzdGl0dXRpb24yO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgYjJDb250YWN0RWRnZSB7XHJcbiAgcmVhZG9ubHkgY29udGFjdDogYjJDb250YWN0O1xyXG4gIHByaXZhdGUgX290aGVyOiBiMkJvZHkgfCBudWxsID0gbnVsbDsgLy8vPCBwcm92aWRlcyBxdWljayBhY2Nlc3MgdG8gdGhlIG90aGVyIGJvZHkgYXR0YWNoZWQuXHJcbiAgcHJldjogYjJDb250YWN0RWRnZSB8IG51bGwgPSBudWxsOyAvLy88IHRoZSBwcmV2aW91cyBjb250YWN0IGVkZ2UgaW4gdGhlIGJvZHkncyBjb250YWN0IGxpc3RcclxuICBuZXh0OiBiMkNvbnRhY3RFZGdlIHwgbnVsbCA9IG51bGw7IC8vLzwgdGhlIG5leHQgY29udGFjdCBlZGdlIGluIHRoZSBib2R5J3MgY29udGFjdCBsaXN0XHJcblxyXG4gIGNvbnN0cnVjdG9yKGNvbnRhY3Q6IGIyQ29udGFjdCkge1xyXG4gICAgdGhpcy5jb250YWN0ID0gY29udGFjdDtcclxuICB9XHJcblxyXG4gIFJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5fb3RoZXIgPSBudWxsO1xyXG4gICAgdGhpcy5wcmV2ID0gbnVsbDtcclxuICAgIHRoaXMubmV4dCA9IG51bGw7XHJcbiAgfVxyXG5cclxuICBnZXQgb3RoZXIoKTogYjJCb2R5IHtcclxuICAgIEIyX0FTU0VSVCAmJiBiMkFzc2VydCh0aGlzLl9vdGhlciAhPT0gbnVsbCk7XHJcbiAgICByZXR1cm4gdGhpcy5fb3RoZXIhO1xyXG4gIH1cclxuXHJcbiAgc2V0IG90aGVyKHZhbHVlOiBiMkJvZHkpIHtcclxuICAgIEIyX0FTU0VSVCAmJiBiMkFzc2VydCh0aGlzLl9vdGhlciA9PT0gbnVsbCk7XHJcbiAgICB0aGlzLl9vdGhlciA9IHZhbHVlO1xyXG4gIH1cclxufVxyXG5cclxuY29uc3QgQ29tcHV0ZVRPSV9zX2lucHV0ID0gbmV3IGIyVE9JSW5wdXQoKTtcclxuY29uc3QgQ29tcHV0ZVRPSV9zX291dHB1dCA9IG5ldyBiMlRPSU91dHB1dCgpO1xyXG5jb25zdCBFdmFsdWF0ZV9zX2VkZ2UgPSBuZXcgYjJFZGdlU2hhcGUoKTtcclxuXHJcbmNvbnN0IEV2YWx1YXRlID0gKGNvbnRhY3Q6IGIyQ29udGFjdCkgPT4ge1xyXG4gIGNvbnN0IHhmQSA9IGNvbnRhY3QubV9maXh0dXJlQS5tX2JvZHkubV94ZjtcclxuICBjb25zdCB4ZkIgPSBjb250YWN0Lm1fZml4dHVyZUIubV9ib2R5Lm1feGY7XHJcbiAgY29uc3QgdHlwZUEgPSBjb250YWN0Lm1fZml4dHVyZUEuX3NoYXBlVHlwZTtcclxuICBjb25zdCB0eXBlQiA9IGNvbnRhY3QubV9maXh0dXJlQi5fc2hhcGVUeXBlO1xyXG4gIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3QubV9maXh0dXJlQS5tX3NoYXBlO1xyXG4gIGNvbnN0IHNoYXBlQiA9IGNvbnRhY3QubV9maXh0dXJlQi5tX3NoYXBlO1xyXG4gIGNvbnN0IG1hbmlmb2xkID0gY29udGFjdC5tX21hbmlmb2xkO1xyXG4gIGNvbnN0IGluZGV4QSA9IGNvbnRhY3QubV9pbmRleEE7XHJcbiAgY29uc3QgcHQgPSAodHlwZUEgPDwgMikgfCB0eXBlQjtcclxuICBpZiAocHQgPT09ICgoYjJTaGFwZVR5cGUuZV9jaXJjbGVTaGFwZSA8PCAyKSB8IGIyU2hhcGVUeXBlLmVfY2lyY2xlU2hhcGUpKSB7XHJcbiAgICBiMkNvbGxpZGVDaXJjbGVzKG1hbmlmb2xkLCBzaGFwZUEgYXMgYjJDaXJjbGVTaGFwZSwgeGZBLCBzaGFwZUIgYXMgYjJDaXJjbGVTaGFwZSwgeGZCKTtcclxuICB9IGVsc2UgaWYgKHB0ID09PSAoKGIyU2hhcGVUeXBlLmVfcG9seWdvblNoYXBlIDw8IDIpIHwgYjJTaGFwZVR5cGUuZV9jaXJjbGVTaGFwZSkpIHtcclxuICAgIGIyQ29sbGlkZVBvbHlnb25BbmRDaXJjbGUoXHJcbiAgICAgIG1hbmlmb2xkLFxyXG4gICAgICBzaGFwZUEgYXMgYjJQb2x5Z29uU2hhcGUsXHJcbiAgICAgIHhmQSxcclxuICAgICAgc2hhcGVCIGFzIGIyQ2lyY2xlU2hhcGUsXHJcbiAgICAgIHhmQixcclxuICAgICk7XHJcbiAgfSBlbHNlIGlmIChwdCA9PT0gKChiMlNoYXBlVHlwZS5lX3BvbHlnb25TaGFwZSA8PCAyKSB8IGIyU2hhcGVUeXBlLmVfcG9seWdvblNoYXBlKSkge1xyXG4gICAgYjJDb2xsaWRlUG9seWdvbnMobWFuaWZvbGQsIHNoYXBlQSBhcyBiMlBvbHlnb25TaGFwZSwgeGZBLCBzaGFwZUIgYXMgYjJQb2x5Z29uU2hhcGUsIHhmQik7XHJcbiAgfSBlbHNlIGlmIChwdCA9PT0gKChiMlNoYXBlVHlwZS5lX2VkZ2VTaGFwZSA8PCAyKSB8IGIyU2hhcGVUeXBlLmVfY2lyY2xlU2hhcGUpKSB7XHJcbiAgICBiMkNvbGxpZGVFZGdlQW5kQ2lyY2xlKG1hbmlmb2xkLCBzaGFwZUEgYXMgYjJFZGdlU2hhcGUsIHhmQSwgc2hhcGVCIGFzIGIyQ2lyY2xlU2hhcGUsIHhmQik7XHJcbiAgfSBlbHNlIGlmIChwdCA9PT0gKChiMlNoYXBlVHlwZS5lX2VkZ2VTaGFwZSA8PCAyKSB8IGIyU2hhcGVUeXBlLmVfcG9seWdvblNoYXBlKSkge1xyXG4gICAgYjJDb2xsaWRlRWRnZUFuZFBvbHlnb24obWFuaWZvbGQsIHNoYXBlQSBhcyBiMkVkZ2VTaGFwZSwgeGZBLCBzaGFwZUIgYXMgYjJQb2x5Z29uU2hhcGUsIHhmQik7XHJcbiAgfSBlbHNlIGlmIChwdCA9PT0gKChiMlNoYXBlVHlwZS5lX2NoYWluU2hhcGUgPDwgMikgfCBiMlNoYXBlVHlwZS5lX2NpcmNsZVNoYXBlKSkge1xyXG4gICAgKHNoYXBlQSBhcyBiMkNoYWluU2hhcGUpLkdldENoaWxkRWRnZShFdmFsdWF0ZV9zX2VkZ2UsIGluZGV4QSk7XHJcbiAgICBiMkNvbGxpZGVFZGdlQW5kQ2lyY2xlKG1hbmlmb2xkLCBFdmFsdWF0ZV9zX2VkZ2UsIHhmQSwgc2hhcGVCIGFzIGIyQ2lyY2xlU2hhcGUsIHhmQik7XHJcbiAgfSBlbHNlIGlmIChwdCA9PT0gKChiMlNoYXBlVHlwZS5lX2NoYWluU2hhcGUgPDwgMikgfCBiMlNoYXBlVHlwZS5lX3BvbHlnb25TaGFwZSkpIHtcclxuICAgIChzaGFwZUEgYXMgYjJDaGFpblNoYXBlKS5HZXRDaGlsZEVkZ2UoRXZhbHVhdGVfc19lZGdlLCBpbmRleEEpO1xyXG4gICAgYjJDb2xsaWRlRWRnZUFuZFBvbHlnb24obWFuaWZvbGQsIEV2YWx1YXRlX3NfZWRnZSwgeGZBLCBzaGFwZUIgYXMgYjJQb2x5Z29uU2hhcGUsIHhmQik7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNsYXNzIGIyQ29udGFjdDxBIGV4dGVuZHMgYjJTaGFwZSA9IGIyU2hhcGUsIEIgZXh0ZW5kcyBiMlNoYXBlID0gYjJTaGFwZT4ge1xyXG4gIG1fcHJldjogYjJDb250YWN0IHwgbnVsbCA9IG51bGw7XHJcbiAgbV9uZXh0OiBiMkNvbnRhY3QgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgcmVhZG9ubHkgbV9ub2RlQTogYjJDb250YWN0RWRnZSA9IG5ldyBiMkNvbnRhY3RFZGdlKHRoaXMpO1xyXG4gIHJlYWRvbmx5IG1fbm9kZUI6IGIyQ29udGFjdEVkZ2UgPSBuZXcgYjJDb250YWN0RWRnZSh0aGlzKTtcclxuXHJcbiAgbV9maXh0dXJlQTogYjJGaXh0dXJlID0gKG51bGwgYXMgdW5rbm93bikgYXMgYjJGaXh0dXJlO1xyXG4gIG1fZml4dHVyZUI6IGIyRml4dHVyZSA9IChudWxsIGFzIHVua25vd24pIGFzIGIyRml4dHVyZTtcclxuXHJcbiAgbV9pbmRleEEgPSAwO1xyXG4gIG1faW5kZXhCID0gMDtcclxuXHJcbiAgbV9tYW5pZm9sZCA9IG5ldyBiMk1hbmlmb2xkKCk7IC8vIFRPRE86IHJlYWRvbmx5XHJcblxyXG4gIG1fdG9pQ291bnQgPSAwO1xyXG4gIG1fdG9pID0gTmFOO1xyXG4gIG1fZnJpY3Rpb24gPSBOYU47XHJcbiAgbV9yZXN0aXR1dGlvbiA9IE5hTjtcclxuICBtX3RhbmdlbnRTcGVlZCA9IE5hTjtcclxuXHJcbiAgbV9vbGRNYW5pZm9sZCA9IG5ldyBiMk1hbmlmb2xkKCk7IC8vIFRPRE86IHJlYWRvbmx5XHJcblxyXG4gIG1faXNsYW5kRmxhZyA9IGZhbHNlOyAvLy8gVXNlZCB3aGVuIGNyYXdsaW5nIGNvbnRhY3QgZ3JhcGggd2hlbiBmb3JtaW5nIGlzbGFuZHMuXHJcbiAgbV90b3VjaGluZ0ZsYWcgPSBmYWxzZTsgLy8vIFNldCB3aGVuIHRoZSBzaGFwZXMgYXJlIHRvdWNoaW5nLlxyXG4gIG1fZW5hYmxlZEZsYWcgPSBmYWxzZTsgLy8vIFRoaXMgY29udGFjdCBjYW4gYmUgZGlzYWJsZWQgKGJ5IHVzZXIpXHJcbiAgbV9maWx0ZXJGbGFnID0gZmFsc2U7IC8vLyBUaGlzIGNvbnRhY3QgbmVlZHMgZmlsdGVyaW5nIGJlY2F1c2UgYSBmaXh0dXJlIGZpbHRlciB3YXMgY2hhbmdlZC5cclxuICBtX2J1bGxldEhpdEZsYWcgPSBmYWxzZTsgLy8vIFRoaXMgYnVsbGV0IGNvbnRhY3QgaGFkIGEgVE9JIGV2ZW50XHJcbiAgbV90b2lGbGFnID0gZmFsc2U7IC8vLyBUaGlzIGNvbnRhY3QgaGFzIGEgdmFsaWQgVE9JIGluIG1fdG9pXHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5tX3RvaSA9IDAuMDtcclxuICAgIHRoaXMubV9mcmljdGlvbiA9IDAuMDtcclxuICAgIHRoaXMubV9yZXN0aXR1dGlvbiA9IDAuMDtcclxuICAgIHRoaXMubV90YW5nZW50U3BlZWQgPSAwLjA7XHJcbiAgfVxyXG5cclxuICBHZXRNYW5pZm9sZCgpIHtcclxuICAgIHJldHVybiB0aGlzLm1fbWFuaWZvbGQ7XHJcbiAgfVxyXG5cclxuICBHZXRXb3JsZE1hbmlmb2xkKHdvcmxkTWFuaWZvbGQ6IGIyV29ybGRNYW5pZm9sZCk6IHZvaWQge1xyXG4gICAgd29ybGRNYW5pZm9sZC5Jbml0aWFsaXplKFxyXG4gICAgICB0aGlzLm1fbWFuaWZvbGQsXHJcbiAgICAgIHRoaXMubV9maXh0dXJlQS5tX2JvZHkubV94ZixcclxuICAgICAgdGhpcy5tX2ZpeHR1cmVBLl9zaGFwZVJhZGl1cyxcclxuICAgICAgdGhpcy5tX2ZpeHR1cmVCLm1fYm9keS5tX3hmLFxyXG4gICAgICB0aGlzLm1fZml4dHVyZUIuX3NoYXBlUmFkaXVzLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIElzVG91Y2hpbmcoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5tX3RvdWNoaW5nRmxhZztcclxuICB9XHJcblxyXG4gIFNldEVuYWJsZWQoZmxhZzogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgdGhpcy5tX2VuYWJsZWRGbGFnID0gZmxhZztcclxuICB9XHJcblxyXG4gIElzRW5hYmxlZCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLm1fZW5hYmxlZEZsYWc7XHJcbiAgfVxyXG5cclxuICBHZXROZXh0KCk6IGIyQ29udGFjdCB8IG51bGwge1xyXG4gICAgcmV0dXJuIHRoaXMubV9uZXh0O1xyXG4gIH1cclxuXHJcbiAgR2V0Rml4dHVyZUEoKTogYjJGaXh0dXJlIHtcclxuICAgIHJldHVybiB0aGlzLm1fZml4dHVyZUE7XHJcbiAgfVxyXG5cclxuICBHZXRDaGlsZEluZGV4QSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMubV9pbmRleEE7XHJcbiAgfVxyXG5cclxuICBHZXRTaGFwZUEoKTogQSB7XHJcbiAgICByZXR1cm4gdGhpcy5tX2ZpeHR1cmVBLkdldFNoYXBlKCkgYXMgQTtcclxuICB9XHJcblxyXG4gIEdldEZpeHR1cmVCKCk6IGIyRml4dHVyZSB7XHJcbiAgICByZXR1cm4gdGhpcy5tX2ZpeHR1cmVCO1xyXG4gIH1cclxuXHJcbiAgR2V0Q2hpbGRJbmRleEIoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLm1faW5kZXhCO1xyXG4gIH1cclxuXHJcbiAgR2V0U2hhcGVCKCk6IEIge1xyXG4gICAgcmV0dXJuIHRoaXMubV9maXh0dXJlQi5HZXRTaGFwZSgpIGFzIEI7XHJcbiAgfVxyXG5cclxuICBGbGFnRm9yRmlsdGVyaW5nKCk6IHZvaWQge1xyXG4gICAgdGhpcy5tX2ZpbHRlckZsYWcgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgU2V0RnJpY3Rpb24oZnJpY3Rpb246IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy5tX2ZyaWN0aW9uID0gZnJpY3Rpb247XHJcbiAgfVxyXG5cclxuICBHZXRGcmljdGlvbigpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMubV9mcmljdGlvbjtcclxuICB9XHJcblxyXG4gIFJlc2V0RnJpY3Rpb24oKTogdm9pZCB7XHJcbiAgICB0aGlzLm1fZnJpY3Rpb24gPSBiMk1peEZyaWN0aW9uKHRoaXMubV9maXh0dXJlQS5tX2ZyaWN0aW9uLCB0aGlzLm1fZml4dHVyZUIubV9mcmljdGlvbik7XHJcbiAgfVxyXG5cclxuICBTZXRSZXN0aXR1dGlvbihyZXN0aXR1dGlvbjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICB0aGlzLm1fcmVzdGl0dXRpb24gPSByZXN0aXR1dGlvbjtcclxuICB9XHJcblxyXG4gIEdldFJlc3RpdHV0aW9uKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5tX3Jlc3RpdHV0aW9uO1xyXG4gIH1cclxuXHJcbiAgUmVzZXRSZXN0aXR1dGlvbigpOiB2b2lkIHtcclxuICAgIHRoaXMubV9yZXN0aXR1dGlvbiA9IGIyTWl4UmVzdGl0dXRpb24oXHJcbiAgICAgIHRoaXMubV9maXh0dXJlQS5tX3Jlc3RpdHV0aW9uLFxyXG4gICAgICB0aGlzLm1fZml4dHVyZUIubV9yZXN0aXR1dGlvbixcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBTZXRUYW5nZW50U3BlZWQoc3BlZWQ6IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy5tX3RhbmdlbnRTcGVlZCA9IHNwZWVkO1xyXG4gIH1cclxuXHJcbiAgR2V0VGFuZ2VudFNwZWVkKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5tX3RhbmdlbnRTcGVlZDtcclxuICB9XHJcblxyXG4gIFJlc2V0KGZpeHR1cmVBOiBiMkZpeHR1cmUsIGluZGV4QTogbnVtYmVyLCBmaXh0dXJlQjogYjJGaXh0dXJlLCBpbmRleEI6IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy5tX2lzbGFuZEZsYWcgPSBmYWxzZTtcclxuICAgIHRoaXMubV90b3VjaGluZ0ZsYWcgPSBmYWxzZTtcclxuICAgIHRoaXMubV9lbmFibGVkRmxhZyA9IHRydWU7XHJcbiAgICB0aGlzLm1fZmlsdGVyRmxhZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5tX2J1bGxldEhpdEZsYWcgPSBmYWxzZTtcclxuICAgIHRoaXMubV90b2lGbGFnID0gZmFsc2U7XHJcblxyXG4gICAgdGhpcy5tX2ZpeHR1cmVBID0gZml4dHVyZUE7XHJcbiAgICB0aGlzLm1fZml4dHVyZUIgPSBmaXh0dXJlQjtcclxuXHJcbiAgICB0aGlzLm1faW5kZXhBID0gaW5kZXhBO1xyXG4gICAgdGhpcy5tX2luZGV4QiA9IGluZGV4QjtcclxuXHJcbiAgICB0aGlzLm1fbWFuaWZvbGQucG9pbnRDb3VudCA9IDA7XHJcblxyXG4gICAgdGhpcy5tX3ByZXYgPSBudWxsO1xyXG4gICAgdGhpcy5tX25leHQgPSBudWxsO1xyXG5cclxuICAgIHRoaXMubV9ub2RlQS5SZXNldCgpO1xyXG4gICAgdGhpcy5tX25vZGVCLlJlc2V0KCk7XHJcblxyXG4gICAgdGhpcy5tX3RvaUNvdW50ID0gMDtcclxuXHJcbiAgICB0aGlzLm1fZnJpY3Rpb24gPSBiMk1peEZyaWN0aW9uKHRoaXMubV9maXh0dXJlQS5tX2ZyaWN0aW9uLCB0aGlzLm1fZml4dHVyZUIubV9mcmljdGlvbik7XHJcbiAgICB0aGlzLm1fcmVzdGl0dXRpb24gPSBiMk1peFJlc3RpdHV0aW9uKFxyXG4gICAgICB0aGlzLm1fZml4dHVyZUEubV9yZXN0aXR1dGlvbixcclxuICAgICAgdGhpcy5tX2ZpeHR1cmVCLm1fcmVzdGl0dXRpb24sXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgVXBkYXRlKGxpc3RlbmVyOiBiMkNvbnRhY3RMaXN0ZW5lcik6IHZvaWQge1xyXG4gICAgY29uc3QgdE1hbmlmb2xkOiBiMk1hbmlmb2xkID0gdGhpcy5tX29sZE1hbmlmb2xkO1xyXG4gICAgdGhpcy5tX29sZE1hbmlmb2xkID0gdGhpcy5tX21hbmlmb2xkO1xyXG4gICAgdGhpcy5tX21hbmlmb2xkID0gdE1hbmlmb2xkO1xyXG5cclxuICAgIC8vIFJlLWVuYWJsZSB0aGlzIGNvbnRhY3QuXHJcbiAgICB0aGlzLm1fZW5hYmxlZEZsYWcgPSB0cnVlO1xyXG5cclxuICAgIGxldCB0b3VjaGluZyA9IGZhbHNlO1xyXG4gICAgY29uc3Qgd2FzVG91Y2hpbmc6IGJvb2xlYW4gPSB0aGlzLm1fdG91Y2hpbmdGbGFnO1xyXG5cclxuICAgIGNvbnN0IHNlbnNvckEgPSB0aGlzLm1fZml4dHVyZUEuSXNTZW5zb3IoKTtcclxuICAgIGNvbnN0IHNlbnNvckIgPSB0aGlzLm1fZml4dHVyZUIuSXNTZW5zb3IoKTtcclxuICAgIGNvbnN0IHNlbnNvciA9IHNlbnNvckEgfHwgc2Vuc29yQjtcclxuXHJcbiAgICBjb25zdCBib2R5QSA9IHRoaXMubV9maXh0dXJlQS5HZXRCb2R5KCk7XHJcbiAgICBjb25zdCBib2R5QiA9IHRoaXMubV9maXh0dXJlQi5HZXRCb2R5KCk7XHJcbiAgICBjb25zdCB4ZkEgPSBib2R5QS5HZXRUcmFuc2Zvcm0oKTtcclxuICAgIGNvbnN0IHhmQiA9IGJvZHlCLkdldFRyYW5zZm9ybSgpO1xyXG4gICAgY29uc3Qgc2hhcGVBOiBBID0gdGhpcy5HZXRTaGFwZUEoKTtcclxuICAgIGNvbnN0IHNoYXBlQjogQiA9IHRoaXMuR2V0U2hhcGVCKCk7XHJcblxyXG4gICAgLy8gSXMgdGhpcyBjb250YWN0IGEgc2Vuc29yP1xyXG4gICAgaWYgKHNlbnNvcikge1xyXG4gICAgICB0b3VjaGluZyA9IGIyVGVzdE92ZXJsYXBTaGFwZShzaGFwZUEsIHRoaXMubV9pbmRleEEsIHNoYXBlQiwgdGhpcy5tX2luZGV4QiwgeGZBLCB4ZkIpO1xyXG5cclxuICAgICAgLy8gU2Vuc29ycyBkb24ndCBnZW5lcmF0ZSBtYW5pZm9sZHMuXHJcbiAgICAgIHRoaXMubV9tYW5pZm9sZC5wb2ludENvdW50ID0gMDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIEV2YWx1YXRlKHRoaXMpO1xyXG4gICAgICB0b3VjaGluZyA9IHRoaXMubV9tYW5pZm9sZC5wb2ludENvdW50ID4gMDtcclxuXHJcbiAgICAgIC8vIE1hdGNoIG9sZCBjb250YWN0IGlkcyB0byBuZXcgY29udGFjdCBpZHMgYW5kIGNvcHkgdGhlXHJcbiAgICAgIC8vIHN0b3JlZCBpbXB1bHNlcyB0byB3YXJtIHN0YXJ0IHRoZSBzb2x2ZXIuXHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tX21hbmlmb2xkLnBvaW50Q291bnQ7ICsraSkge1xyXG4gICAgICAgIGNvbnN0IG1wMjogYjJNYW5pZm9sZFBvaW50ID0gdGhpcy5tX21hbmlmb2xkLnBvaW50c1tpXTtcclxuICAgICAgICBtcDIubm9ybWFsSW1wdWxzZSA9IDA7XHJcbiAgICAgICAgbXAyLnRhbmdlbnRJbXB1bHNlID0gMDtcclxuICAgICAgICBjb25zdCBpZDI6IGIyQ29udGFjdElEID0gbXAyLmlkO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMubV9vbGRNYW5pZm9sZC5wb2ludENvdW50OyArK2opIHtcclxuICAgICAgICAgIGNvbnN0IG1wMTogYjJNYW5pZm9sZFBvaW50ID0gdGhpcy5tX29sZE1hbmlmb2xkLnBvaW50c1tqXTtcclxuXHJcbiAgICAgICAgICBpZiAobXAxLmlkLmtleSA9PT0gaWQyLmtleSkge1xyXG4gICAgICAgICAgICBtcDIubm9ybWFsSW1wdWxzZSA9IG1wMS5ub3JtYWxJbXB1bHNlO1xyXG4gICAgICAgICAgICBtcDIudGFuZ2VudEltcHVsc2UgPSBtcDEudGFuZ2VudEltcHVsc2U7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHRvdWNoaW5nICE9PSB3YXNUb3VjaGluZykge1xyXG4gICAgICAgIGJvZHlBLlNldEF3YWtlKHRydWUpO1xyXG4gICAgICAgIGJvZHlCLlNldEF3YWtlKHRydWUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5tX3RvdWNoaW5nRmxhZyA9IHRvdWNoaW5nO1xyXG5cclxuICAgIGlmICghd2FzVG91Y2hpbmcgJiYgdG91Y2hpbmcpIHtcclxuICAgICAgbGlzdGVuZXIuQmVnaW5Db250YWN0KHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh3YXNUb3VjaGluZyAmJiAhdG91Y2hpbmcpIHtcclxuICAgICAgbGlzdGVuZXIuRW5kQ29udGFjdCh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXNlbnNvciAmJiB0b3VjaGluZykge1xyXG4gICAgICBsaXN0ZW5lci5QcmVTb2x2ZSh0aGlzLCB0aGlzLm1fb2xkTWFuaWZvbGQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQ29tcHV0ZVRPSShzd2VlcEE6IGIyU3dlZXAsIHN3ZWVwQjogYjJTd2VlcCk6IG51bWJlciB7XHJcbiAgICBjb25zdCBpbnB1dCA9IENvbXB1dGVUT0lfc19pbnB1dDtcclxuICAgIGlucHV0LnByb3h5QS5TZXRTaGFwZSh0aGlzLkdldFNoYXBlQSgpLCB0aGlzLm1faW5kZXhBKTtcclxuICAgIGlucHV0LnByb3h5Qi5TZXRTaGFwZSh0aGlzLkdldFNoYXBlQigpLCB0aGlzLm1faW5kZXhCKTtcclxuICAgIGlucHV0LnN3ZWVwQS5Db3B5KHN3ZWVwQSk7XHJcbiAgICBpbnB1dC5zd2VlcEIuQ29weShzd2VlcEIpO1xyXG4gICAgaW5wdXQudE1heCA9IGIyX2xpbmVhclNsb3A7XHJcblxyXG4gICAgY29uc3Qgb3V0cHV0ID0gQ29tcHV0ZVRPSV9zX291dHB1dDtcclxuXHJcbiAgICBiMlRpbWVPZkltcGFjdChvdXRwdXQsIGlucHV0KTtcclxuXHJcbiAgICByZXR1cm4gb3V0cHV0LnQ7XHJcbiAgfVxyXG59XHJcbiJdfQ==