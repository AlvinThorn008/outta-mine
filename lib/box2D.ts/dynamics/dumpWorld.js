import { DumpJoint } from './joints/dumpJoints';
import { DumpShape } from '../collision/shapes/dumpShapes';
import { b2Assert } from '../common/b2Settings';
/// Dump the world into the log file.
/// @warning this should be called outside of a time step.
// TODO: all of them :)
function DumpFixture(fixture, log, bodyIndex) {
    log('    const fd: b2FixtureDef = new b2FixtureDef();\n');
    log('    fd.friction = %.15f;\n', fixture.m_friction);
    log('    fd.restitution = %.15f;\n', fixture.m_restitution);
    log('    fd.density = %.15f;\n', fixture.m_density);
    log('    fd.isSensor = %s;\n', fixture.m_isSensor ? 'true' : 'false');
    log('    fd.filter.categoryBits = %d;\n', fixture.m_filter.categoryBits);
    log('    fd.filter.maskBits = %d;\n', fixture.m_filter.maskBits);
    log('    fd.filter.groupIndex = %d;\n', fixture.m_filter.groupIndex);
    DumpShape(fixture.m_shape, log);
    log('\n');
    log('    fd.shape = shape;\n');
    log('\n');
    log('    bodies[%d].CreateFixture(fd);\n', bodyIndex);
}
/// Dump this body to a log file
function DumpBody(body, log) {
    const bodyIndex = body.m_islandIndex;
    log('{\n');
    log('  const bd: b2BodyDef = new b2BodyDef();\n');
    let type_str = '';
    switch (body.m_type) {
        case 0 /* b2_staticBody */:
            type_str = 'b2BodyType.b2_staticBody';
            break;
        case 1 /* b2_kinematicBody */:
            type_str = 'b2BodyType.b2_kinematicBody';
            break;
        case 2 /* b2_dynamicBody */:
            type_str = 'b2BodyType.b2_dynamicBody';
            break;
        default:
            !!B2_DEBUG && b2Assert(false);
            break;
    }
    log('  bd.type = %s;\n', type_str);
    log('  bd.position.Set(%.15f, %.15f);\n', body.m_xf.p.x, body.m_xf.p.y);
    log('  bd.angle = %.15f;\n', body.m_sweep.a);
    log('  bd.linearVelocity.Set(%.15f, %.15f);\n', body.m_linearVelocity.x, body.m_linearVelocity.y);
    log('  bd.angularVelocity = %.15f;\n', body.m_angularVelocity);
    log('  bd.linearDamping = %.15f;\n', body.m_linearDamping);
    log('  bd.angularDamping = %.15f;\n', body.m_angularDamping);
    log('  bd.allowSleep = %s;\n', body.m_autoSleepFlag ? 'true' : 'false');
    log('  bd.awake = %s;\n', body.m_awakeFlag ? 'true' : 'false');
    log('  bd.fixedRotation = %s;\n', body.m_fixedRotationFlag ? 'true' : 'false');
    log('  bd.bullet = %s;\n', body.m_bulletFlag ? 'true' : 'false');
    log('  bd.active = %s;\n', body.m_activeFlag ? 'true' : 'false');
    log('  bd.gravityScale = %.15f;\n', body.m_gravityScale);
    log('\n');
    log('  bodies[%d] = this.m_world.CreateBody(bd);\n', body.m_islandIndex);
    log('\n');
    for (let f = body.m_fixtureList; f; f = f.m_next) {
        log('  {\n');
        DumpFixture(f, log, bodyIndex);
        log('  }\n');
    }
    log('}\n');
}
export function DumpWorld(world, log) {
    if (world.m_locked) {
        return;
    }
    log('const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n', world.m_gravity.x, world.m_gravity.y);
    log('this.m_world.SetGravity(g);\n');
    log('const bodies: b2Body[] = [];\n');
    log('const joints: b2Joint[] = [];\n');
    let i = 0;
    for (let b = world.m_bodyList; b; b = b.m_next) {
        b.m_islandIndex = i;
        DumpBody(b, log);
        ++i;
    }
    i = 0;
    for (let j = world.m_jointList; j; j = j.m_next) {
        j._logIndex = i;
        ++i;
    }
    // First pass on joints, skip gear joints.
    for (let j = world.m_jointList; j; j = j.m_next) {
        if (j.m_type === 6 /* e_gearJoint */) {
            continue;
        }
        log('{\n');
        DumpJoint(j, log);
        log('}\n');
    }
    // Second pass on joints, only gear joints.
    for (let j = world.m_jointList; j; j = j.m_next) {
        if (j.m_type !== 6 /* e_gearJoint */) {
            continue;
        }
        log('{\n');
        DumpJoint(j, log);
        log('}\n');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHVtcFdvcmxkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2R5bmFtaWNzL2R1bXBXb3JsZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDaEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBSzNELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUVoRCxxQ0FBcUM7QUFDckMsMERBQTBEO0FBQzFELHVCQUF1QjtBQUV2QixTQUFTLFdBQVcsQ0FDbEIsT0FBa0IsRUFDbEIsR0FBNkMsRUFDN0MsU0FBaUI7SUFFakIsR0FBRyxDQUFDLG9EQUFvRCxDQUFDLENBQUM7SUFDMUQsR0FBRyxDQUFDLDRCQUE0QixFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUN0RCxHQUFHLENBQUMsK0JBQStCLEVBQUUsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQzVELEdBQUcsQ0FBQywyQkFBMkIsRUFBRSxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDcEQsR0FBRyxDQUFDLHlCQUF5QixFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDdEUsR0FBRyxDQUFDLG9DQUFvQyxFQUFFLE9BQU8sQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDekUsR0FBRyxDQUFDLGdDQUFnQyxFQUFFLE9BQU8sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDakUsR0FBRyxDQUFDLGtDQUFrQyxFQUFFLE9BQU8sQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFckUsU0FBUyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFFaEMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0lB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U0FBUztTQUNWO1FBRUQsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ1gsU0FBUyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNsQixHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDWjtJQUVELDJDQUEyQztJQUMzQyxLQUFLLElBQUksQ0FBQyxHQUFtQixLQUFLLENBQUMsV0FBVyxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRTtRQUMvRCxJQUFJLENBQUMsQ0FBQyxNQUFNLHdCQUE0QixFQUFFO1lBQ3hDLFNBQVM7U0FDVjtRQUVELEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNYLFNBQVMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDbEIsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQ1o7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRHVtcEpvaW50IH0gZnJvbSAnLi9qb2ludHMvZHVtcEpvaW50cyc7XHJcbmltcG9ydCB7IER1bXBTaGFwZSB9IGZyb20gJy4uL2NvbGxpc2lvbi9zaGFwZXMvZHVtcFNoYXBlcyc7XHJcbmltcG9ydCB7IGIyRml4dHVyZSB9IGZyb20gJy4vYjJGaXh0dXJlJztcclxuaW1wb3J0IHsgYjJCb2R5LCBiMkJvZHlUeXBlIH0gZnJvbSAnLi9iMkJvZHknO1xyXG5pbXBvcnQgeyBiMkpvaW50LCBiMkpvaW50VHlwZSB9IGZyb20gJy4vam9pbnRzL2IySm9pbnQnO1xyXG5pbXBvcnQgeyBiMldvcmxkIH0gZnJvbSAnLi9iMldvcmxkJztcclxuaW1wb3J0IHsgYjJBc3NlcnQgfSBmcm9tICcuLi9jb21tb24vYjJTZXR0aW5ncyc7XHJcblxyXG4vLy8gRHVtcCB0aGUgd29ybGQgaW50byB0aGUgbG9nIGZpbGUuXHJcbi8vLyBAd2FybmluZyB0aGlzIHNob3VsZCBiZSBjYWxsZWQgb3V0c2lkZSBvZiBhIHRpbWUgc3RlcC5cclxuLy8gVE9ETzogYWxsIG9mIHRoZW0gOilcclxuXHJcbmZ1bmN0aW9uIER1bXBGaXh0dXJlKFxyXG4gIGZpeHR1cmU6IGIyRml4dHVyZSxcclxuICBsb2c6IChmb3JtYXQ6IHN0cmluZywgLi4uYXJnczogYW55W10pID0+IHZvaWQsXHJcbiAgYm9keUluZGV4OiBudW1iZXIsXHJcbik6IHZvaWQge1xyXG4gIGxvZygnICAgIGNvbnN0IGZkOiBiMkZpeHR1cmVEZWYgPSBuZXcgYjJGaXh0dXJlRGVmKCk7XFxuJyk7XHJcbiAgbG9nKCcgICAgZmQuZnJpY3Rpb24gPSAlLjE1ZjtcXG4nLCBmaXh0dXJlLm1fZnJpY3Rpb24pO1xyXG4gIGxvZygnICAgIGZkLnJlc3RpdHV0aW9uID0gJS4xNWY7XFxuJywgZml4dHVyZS5tX3Jlc3RpdHV0aW9uKTtcclxuICBsb2coJyAgICBmZC5kZW5zaXR5ID0gJS4xNWY7XFxuJywgZml4dHVyZS5tX2RlbnNpdHkpO1xyXG4gIGxvZygnICAgIGZkLmlzU2Vuc29yID0gJXM7XFxuJywgZml4dHVyZS5tX2lzU2Vuc29yID8gJ3RydWUnIDogJ2ZhbHNlJyk7XHJcbiAgbG9nKCcgICAgZmQuZmlsdGVyLmNhdGVnb3J5Qml0cyA9ICVkO1xcbicsIGZpeHR1cmUubV9maWx0ZXIuY2F0ZWdvcnlCaXRzKTtcclxuICBsb2coJyAgICBmZC5maWx0ZXIubWFza0JpdHMgPSAlZDtcXG4nLCBmaXh0dXJlLm1fZmlsdGVyLm1hc2tCaXRzKTtcclxuICBsb2coJyAgICBmZC5maWx0ZXIuZ3JvdXBJbmRleCA9ICVkO1xcbicsIGZpeHR1cmUubV9maWx0ZXIuZ3JvdXBJbmRleCk7XHJcblxyXG4gIER1bXBTaGFwZShmaXh0dXJlLm1fc2hhcGUsIGxvZyk7XHJcblxyXG4gIGxvZygnXFxuJyk7XHJcbiAgbG9nKCcgICAgZmQuc2hhcGUgPSBzaGFwZTtcXG4nKTtcclxuICBsb2coJ1xcbicpO1xyXG4gIGxvZygnICAgIGJvZGllc1slZF0uQ3JlYXRlRml4dHVyZShmZCk7XFxuJywgYm9keUluZGV4KTtcclxufVxyXG5cclxuLy8vIER1bXAgdGhpcyBib2R5IHRvIGEgbG9nIGZpbGVcclxuZnVuY3Rpb24gRHVtcEJvZHkoYm9keTogYjJCb2R5LCBsb2c6IChmb3JtYXQ6IHN0cmluZywgLi4uYXJnczogYW55W10pID0+IHZvaWQpOiB2b2lkIHtcclxuICBjb25zdCBib2R5SW5kZXg6IG51bWJlciA9IGJvZHkubV9pc2xhbmRJbmRleDtcclxuXHJcbiAgbG9nKCd7XFxuJyk7XHJcbiAgbG9nKCcgIGNvbnN0IGJkOiBiMkJvZHlEZWYgPSBuZXcgYjJCb2R5RGVmKCk7XFxuJyk7XHJcbiAgbGV0IHR5cGVfc3RyID0gJyc7XHJcbiAgc3dpdGNoIChib2R5Lm1fdHlwZSkge1xyXG4gICAgY2FzZSBiMkJvZHlUeXBlLmIyX3N0YXRpY0JvZHk6XHJcbiAgICAgIHR5cGVfc3RyID0gJ2IyQm9keVR5cGUuYjJfc3RhdGljQm9keSc7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSBiMkJvZHlUeXBlLmIyX2tpbmVtYXRpY0JvZHk6XHJcbiAgICAgIHR5cGVfc3RyID0gJ2IyQm9keVR5cGUuYjJfa2luZW1hdGljQm9keSc7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSBiMkJvZHlUeXBlLmIyX2R5bmFtaWNCb2R5OlxyXG4gICAgICB0eXBlX3N0ciA9ICdiMkJvZHlUeXBlLmIyX2R5bmFtaWNCb2R5JztcclxuICAgICAgYnJlYWs7XHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICAhIUIyX0RFQlVHICYmIGIyQXNzZXJ0KGZhbHNlKTtcclxuICAgICAgYnJlYWs7XHJcbiAgfVxyXG4gIGxvZygnICBiZC50eXBlID0gJXM7XFxuJywgdHlwZV9zdHIpO1xyXG4gIGxvZygnICBiZC5wb3NpdGlvbi5TZXQoJS4xNWYsICUuMTVmKTtcXG4nLCBib2R5Lm1feGYucC54LCBib2R5Lm1feGYucC55KTtcclxuICBsb2coJyAgYmQuYW5nbGUgPSAlLjE1ZjtcXG4nLCBib2R5Lm1fc3dlZXAuYSk7XHJcbiAgbG9nKCcgIGJkLmxpbmVhclZlbG9jaXR5LlNldCglLjE1ZiwgJS4xNWYpO1xcbicsIGJvZHkubV9saW5lYXJWZWxvY2l0eS54LCBib2R5Lm1fbGluZWFyVmVsb2NpdHkueSk7XHJcbiAgbG9nKCcgIGJkLmFuZ3VsYXJWZWxvY2l0eSA9ICUuMTVmO1xcbicsIGJvZHkubV9hbmd1bGFyVmVsb2NpdHkpO1xyXG4gIGxvZygnICBiZC5saW5lYXJEYW1waW5nID0gJS4xNWY7XFxuJywgYm9keS5tX2xpbmVhckRhbXBpbmcpO1xyXG4gIGxvZygnICBiZC5hbmd1bGFyRGFtcGluZyA9ICUuMTVmO1xcbicsIGJvZHkubV9hbmd1bGFyRGFtcGluZyk7XHJcbiAgbG9nKCcgIGJkLmFsbG93U2xlZXAgPSAlcztcXG4nLCBib2R5Lm1fYXV0b1NsZWVwRmxhZyA/ICd0cnVlJyA6ICdmYWxzZScpO1xyXG4gIGxvZygnICBiZC5hd2FrZSA9ICVzO1xcbicsIGJvZHkubV9hd2FrZUZsYWcgPyAndHJ1ZScgOiAnZmFsc2UnKTtcclxuICBsb2coJyAgYmQuZml4ZWRSb3RhdGlvbiA9ICVzO1xcbicsIGJvZHkubV9maXhlZFJvdGF0aW9uRmxhZyA/ICd0cnVlJyA6ICdmYWxzZScpO1xyXG4gIGxvZygnICBiZC5idWxsZXQgPSAlcztcXG4nLCBib2R5Lm1fYnVsbGV0RmxhZyA/ICd0cnVlJyA6ICdmYWxzZScpO1xyXG4gIGxvZygnICBiZC5hY3RpdmUgPSAlcztcXG4nLCBib2R5Lm1fYWN0aXZlRmxhZyA/ICd0cnVlJyA6ICdmYWxzZScpO1xyXG4gIGxvZygnICBiZC5ncmF2aXR5U2NhbGUgPSAlLjE1ZjtcXG4nLCBib2R5Lm1fZ3Jhdml0eVNjYWxlKTtcclxuICBsb2coJ1xcbicpO1xyXG4gIGxvZygnICBib2RpZXNbJWRdID0gdGhpcy5tX3dvcmxkLkNyZWF0ZUJvZHkoYmQpO1xcbicsIGJvZHkubV9pc2xhbmRJbmRleCk7XHJcbiAgbG9nKCdcXG4nKTtcclxuICBmb3IgKGxldCBmOiBiMkZpeHR1cmUgfCBudWxsID0gYm9keS5tX2ZpeHR1cmVMaXN0OyBmOyBmID0gZi5tX25leHQpIHtcclxuICAgIGxvZygnICB7XFxuJyk7XHJcbiAgICBEdW1wRml4dHVyZShmLCBsb2csIGJvZHlJbmRleCk7XHJcbiAgICBsb2coJyAgfVxcbicpO1xyXG4gIH1cclxuICBsb2coJ31cXG4nKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIER1bXBXb3JsZCh3b3JsZDogYjJXb3JsZCwgbG9nOiAoZm9ybWF0OiBzdHJpbmcsIC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgaWYgKHdvcmxkLm1fbG9ja2VkKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICBsb2coJ2NvbnN0IGc6IGIyVmVjMiA9IG5ldyBiMlZlYzIoJS4xNWYsICUuMTVmKTtcXG4nLCB3b3JsZC5tX2dyYXZpdHkueCwgd29ybGQubV9ncmF2aXR5LnkpO1xyXG4gIGxvZygndGhpcy5tX3dvcmxkLlNldEdyYXZpdHkoZyk7XFxuJyk7XHJcblxyXG4gIGxvZygnY29uc3QgYm9kaWVzOiBiMkJvZHlbXSA9IFtdO1xcbicpO1xyXG4gIGxvZygnY29uc3Qgam9pbnRzOiBiMkpvaW50W10gPSBbXTtcXG4nKTtcclxuICBsZXQgaSA9IDA7XHJcbiAgZm9yIChsZXQgYjogYjJCb2R5IHwgbnVsbCA9IHdvcmxkLm1fYm9keUxpc3Q7IGI7IGIgPSBiLm1fbmV4dCkge1xyXG4gICAgYi5tX2lzbGFuZEluZGV4ID0gaTtcclxuICAgIER1bXBCb2R5KGIsIGxvZyk7XHJcbiAgICArK2k7XHJcbiAgfVxyXG5cclxuICBpID0gMDtcclxuICBmb3IgKGxldCBqOiBiMkpvaW50IHwgbnVsbCA9IHdvcmxkLm1fam9pbnRMaXN0OyBqOyBqID0gai5tX25leHQpIHtcclxuICAgIGouX2xvZ0luZGV4ID0gaTtcclxuICAgICsraTtcclxuICB9XHJcblxyXG4gIC8vIEZpcnN0IHBhc3Mgb24gam9pbnRzLCBza2lwIGdlYXIgam9pbnRzLlxyXG4gIGZvciAobGV0IGo6IGIySm9pbnQgfCBudWxsID0gd29ybGQubV9qb2ludExpc3Q7IGo7IGogPSBqLm1fbmV4dCkge1xyXG4gICAgaWYgKGoubV90eXBlID09PSBiMkpvaW50VHlwZS5lX2dlYXJKb2ludCkge1xyXG4gICAgICBjb250aW51ZTtcclxuICAgIH1cclxuXHJcbiAgICBsb2coJ3tcXG4nKTtcclxuICAgIER1bXBKb2ludChqLCBsb2cpO1xyXG4gICAgbG9nKCd9XFxuJyk7XHJcbiAgfVxyXG5cclxuICAvLyBTZWNvbmQgcGFzcyBvbiBqb2ludHMsIG9ubHkgZ2VhciBqb2ludHMuXHJcbiAgZm9yIChsZXQgajogYjJKb2ludCB8IG51bGwgPSB3b3JsZC5tX2pvaW50TGlzdDsgajsgaiA9IGoubV9uZXh0KSB7XHJcbiAgICBpZiAoai5tX3R5cGUgIT09IGIySm9pbnRUeXBlLmVfZ2VhckpvaW50KSB7XHJcbiAgICAgIGNvbnRpbnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGxvZygne1xcbicpO1xyXG4gICAgRHVtcEpvaW50KGosIGxvZyk7XHJcbiAgICBsb2coJ31cXG4nKTtcclxuICB9XHJcbn1cclxuIl19