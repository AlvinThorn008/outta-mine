/*
 * Copyright (c) 2006-2009 Erin Catto http://www.box2d.org
 *
 * This software is provided 'as-is', without any express or implied
 * warranty.  In no event will the authors be held liable for any damages
 * arising from the use of this software.
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 * 1. The origin of this software must not be misrepresented; you must not
 * claim that you wrote the original software. If you use this software
 * in a product, an acknowledgment in the product documentation would be
 * appreciated but is not required.
 * 2. Altered source versions must be plainly marked as such, and must not be
 * misrepresented as being the original software.
 * 3. This notice may not be removed or altered from any source distribution.
 */
/* eslint-disable @typescript-eslint/no-empty-function */
import { b2_maxManifoldPoints, b2MakeNumberArray } from '../common/b2Settings';
/// Joints and fixtures are destroyed when their associated
/// body is destroyed. Implement this listener so that you
/// may nullify references to these joints and shapes.
export class b2DestructionListener {
    /// Called when any joint is about to be destroyed due
    /// to the destruction of one of its attached bodies.
    SayGoodbyeJoint(joint) { }
    /// Called when any fixture is about to be destroyed due
    /// to the destruction of its parent body.
    SayGoodbyeFixture(fixture) { }
    // #if B2_ENABLE_PARTICLE
    /// Called when any particle group is about to be destroyed.
    SayGoodbyeParticleGroup(group) { }
    /// Called when a particle is about to be destroyed.
    /// The index can be used in conjunction with
    /// b2ParticleSystem::GetUserDataBuffer() or
    /// b2ParticleSystem::GetParticleHandleFromIndex() to determine which
    /// particle has been destroyed.
    SayGoodbyeParticle(system, index) { }
}
/// Implement this class to provide collision filtering. In other words, you can implement
/// this class if you want finer control over contact creation.
export class b2ContactFilter {
    /// Return true if contact calculations should be performed between these two shapes.
    /// @warning for performance reasons this is only called when the AABBs begin to overlap.
    ShouldCollide(fixtureA, fixtureB) {
        const bodyA = fixtureA.GetBody();
        const bodyB = fixtureB.GetBody();
        // At least one body should be dynamic or kinematic.
        if (bodyB.GetType() === 0 /* b2_staticBody */ &&
            bodyA.GetType() === 0 /* b2_staticBody */) {
            return false;
        }
        // Does a joint prevent collision?
        if (!bodyB.ShouldCollideConnected(bodyA)) {
            return false;
        }
        const filter1 = fixtureA.GetFilterData();
        const filter2 = fixtureB.GetFilterData();
        if (filter1.groupIndex === filter2.groupIndex && filter1.groupIndex !== 0) {
            return filter1.groupIndex > 0;
        }
        const collide = (filter1.maskBits & filter2.categoryBits) !== 0 &&
            (filter1.categoryBits & filter2.maskBits) !== 0;
        return collide;
    }
    // #if B2_ENABLE_PARTICLE
    ShouldCollideFixtureParticle(fixture, system, index) {
        return true;
    }
    ShouldCollideParticleParticle(system, indexA, indexB) {
        return true;
    }
}
// #endif
b2ContactFilter.b2_defaultFilter = new b2ContactFilter();
/// Contact impulses for reporting. Impulses are used instead of forces because
/// sub-step forces may approach infinity for rigid body collisions. These
/// match up one-to-one with the contact points in b2Manifold.
export class b2ContactImpulse {
    constructor() {
        this.normalImpulses = b2MakeNumberArray(b2_maxManifoldPoints);
        this.tangentImpulses = b2MakeNumberArray(b2_maxManifoldPoints);
        this.count = 0;
    }
}
/// Implement this class to get contact information. You can use these results for
/// things like sounds and game logic. You can also get contact results by
/// traversing the contact lists after the time step. However, you might miss
/// some contacts because continuous physics leads to sub-stepping.
/// Additionally you may receive multiple callbacks for the same contact in a
/// single time step.
/// You should strive to make your callbacks efficient because there may be
/// many callbacks per time step.
/// @warning You cannot create/destroy Box2D entities inside these callbacks.
export class b2ContactListener {
    /// Called when two fixtures begin to touch.
    BeginContact(contact) { }
    /// Called when two fixtures cease to touch.
    EndContact(contact) { }
    // #if B2_ENABLE_PARTICLE
    BeginContactFixtureParticle(system, contact) { }
    EndContactFixtureParticle(system, contact) { }
    BeginContactParticleParticle(system, contact) { }
    EndContactParticleParticle(system, contact) { }
    // #endif
    /// This is called after a contact is updated. This allows you to inspect a
    /// contact before it goes to the solver. If you are careful, you can modify the
    /// contact manifold (e.g. disable contact).
    /// A copy of the old manifold is provided so that you can detect changes.
    /// Note: this is called only for awake bodies.
    /// Note: this is called even when the number of contact points is zero.
    /// Note: this is not called for sensors.
    /// Note: if you set the number of contact points to zero, you will not
    /// get an EndContact callback. However, you may get a BeginContact callback
    /// the next step.
    PreSolve(contact, oldManifold) { }
    /// This lets you inspect a contact after the solver is finished. This is useful
    /// for inspecting impulses.
    /// Note: the contact manifold does not include time of impact impulses, which can be
    /// arbitrarily large if the sub-step is small. Hence the impulse is provided explicitly
    /// in a separate data structure.
    /// Note: this is only called for contacts that are touching, solid, and awake.
    PostSolve(contact, impulse) { }
}
b2ContactListener.b2_defaultListener = new b2ContactListener();
/// Callback class for AABB queries.
/// See b2World::Query
export class b2QueryCallback {
    /// Called for each fixture found in the query AABB.
    /// @return false to terminate the query.
    ReportFixture(fixture) {
        return true;
    }
    // #if B2_ENABLE_PARTICLE
    ReportParticle(system, index) {
        return false;
    }
    ShouldQueryParticleSystem(system) {
        return true;
    }
}
/// Callback class for ray casts.
/// See b2World::RayCast
export class b2RayCastCallback {
    /// Called for each fixture found in the query. You control how the ray cast
    /// proceeds by returning a float:
    /// return -1: ignore this fixture and continue
    /// return 0: terminate the ray cast
    /// return fraction: clip the ray to this point
    /// return 1: don't clip the ray and continue
    /// @param fixture the fixture hit by the ray
    /// @param point the point of initial intersection
    /// @param normal the normal vector at the point of intersection
    /// @return -1 to filter, 0 to terminate, fraction to clip the ray for
    /// closest hit, 1 to continue
    ReportFixture(fixture, point, normal, fraction) {
        return fraction;
    }
    // #if B2_ENABLE_PARTICLE
    ReportParticle(system, index, point, normal, fraction) {
        return 0;
    }
    ShouldQueryParticleSystem(system) {
        return true;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYjJXb3JsZENhbGxiYWNrcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9keW5hbWljcy9iMldvcmxkQ2FsbGJhY2tzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7O0dBZ0JHO0FBRUgseURBQXlEO0FBQ3pELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBYy9FLDJEQUEyRDtBQUMzRCwwREFBMEQ7QUFDMUQsc0RBQXNEO0FBQ3RELE1BQU0sT0FBTyxxQkFBcUI7SUFDaEMsc0RBQXNEO0lBQ3RELHFEQUFxRDtJQUNyRCxlQUFlLENBQUMsS0FBYyxJQUFTLENBQUM7SUFFeEMsd0RBQXdEO0lBQ3hELDBDQUEwQztJQUMxQyxpQkFBaUIsQ0FBQyxPQUFrQixJQUFTLENBQUM7SUFFOUMseUJBQXlCO0lBQ3pCLDREQUE0RDtJQUM1RCx1QkFBdUIsQ0FBQyxLQUFzQixJQUFTLENBQUM7SUFFeEQsb0RBQW9EO0lBQ3BELDZDQUE2QztJQUM3Qyw0Q0FBNEM7SUFDNUMscUVBQXFFO0lBQ3JFLGdDQUFnQztJQUNoQyxrQkFBa0IsQ0FBQyxNQUF3QixFQUFFLEtBQWEsSUFBUyxDQUFDO0NBR3JFO0FBRUQsMEZBQTBGO0FBQzFGLCtEQUErRDtBQUMvRCxNQUFNLE9BQU8sZUFBZTtJQUMxQixxRkFBcUY7SUFDckYseUZBQXlGO0lBQ3pGLGFBQWEsQ0FBQyxRQUFtQixFQUFFLFFBQW1CO1FBQ3BELE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNqQyxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFakMsb0RBQW9EO1FBQ3BELElBQ0UsS0FBSyxDQUFDLE9BQU8sRUFBRSwwQkFBNkI7WUFDNUMsS0FBSyxDQUFDLE9BQU8sRUFBRSwwQkFBNkIsRUFDNUM7WUFDQSxPQUFPLEtBQUssQ0FBQztTQUNkO1FB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SUFDekIsY0FBYyxDQUFDLE1BQXdCLEVBQUUsS0FBYTtRQUNwRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCx5QkFBeUIsQ0FBQyxNQUF3QjtRQUNoRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7Q0FHRjtBQUlELGlDQUFpQztBQUNqQyx3QkFBd0I7QUFDeEIsTUFBTSxPQUFPLGlCQUFpQjtJQUM1Qiw0RUFBNEU7SUFDNUUsa0NBQWtDO0lBQ2xDLCtDQUErQztJQUMvQyxvQ0FBb0M7SUFDcEMsK0NBQStDO0lBQy9DLDZDQUE2QztJQUM3Qyw2Q0FBNkM7SUFDN0Msa0RBQWtEO0lBQ2xELGdFQUFnRTtJQUNoRSxzRUFBc0U7SUFDdEUsOEJBQThCO0lBQzlCLGFBQWEsQ0FBQyxPQUFrQixFQUFFLEtBQWEsRUFBRSxNQUFjLEVBQUUsUUFBZ0I7UUFDL0UsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVELHlCQUF5QjtJQUN6QixjQUFjLENBQ1osTUFBd0IsRUFDeEIsS0FBYSxFQUNiLEtBQWEsRUFDYixNQUFjLEVBQ2QsUUFBZ0I7UUFFaEIsT0FBTyxDQUFDLENBQUM7SUFDWCxDQUFDO0lBRUQseUJBQXlCLENBQUMsTUFBd0I7UUFDaEQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBR0YiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMDYtMjAwOSBFcmluIENhdHRvIGh0dHA6Ly93d3cuYm94MmQub3JnXHJcbiAqXHJcbiAqIFRoaXMgc29mdHdhcmUgaXMgcHJvdmlkZWQgJ2FzLWlzJywgd2l0aG91dCBhbnkgZXhwcmVzcyBvciBpbXBsaWVkXHJcbiAqIHdhcnJhbnR5LiAgSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXNcclxuICogYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS5cclxuICogUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsXHJcbiAqIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXRcclxuICogZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOlxyXG4gKiAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdFxyXG4gKiBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZVxyXG4gKiBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmVcclxuICogYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC5cclxuICogMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmVcclxuICogbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLlxyXG4gKiAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLlxyXG4gKi9cclxuXHJcbi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1lbXB0eS1mdW5jdGlvbiAqL1xyXG5pbXBvcnQgeyBiMl9tYXhNYW5pZm9sZFBvaW50cywgYjJNYWtlTnVtYmVyQXJyYXkgfSBmcm9tICcuLi9jb21tb24vYjJTZXR0aW5ncyc7XHJcbmltcG9ydCB7IGIyVmVjMiB9IGZyb20gJy4uL2NvbW1vbi9iMk1hdGgnO1xyXG5pbXBvcnQgeyBiMk1hbmlmb2xkIH0gZnJvbSAnLi4vY29sbGlzaW9uL2IyQ29sbGlzaW9uJztcclxuaW1wb3J0IHsgYjJDb250YWN0IH0gZnJvbSAnLi9jb250YWN0cy9iMkNvbnRhY3QnO1xyXG5pbXBvcnQgeyBiMkJvZHlUeXBlIH0gZnJvbSAnLi9iMkJvZHknO1xyXG5pbXBvcnQgeyBiMkpvaW50IH0gZnJvbSAnLi9qb2ludHMvYjJKb2ludCc7XHJcbmltcG9ydCB7IGIyRmlsdGVyLCBiMkZpeHR1cmUgfSBmcm9tICcuL2IyRml4dHVyZSc7XHJcbmltcG9ydCB7IGIyUGFydGljbGVHcm91cCB9IGZyb20gJy4uL3BhcnRpY2xlL2IyUGFydGljbGVHcm91cCc7XHJcbmltcG9ydCB7XHJcbiAgYjJQYXJ0aWNsZUJvZHlDb250YWN0LFxyXG4gIGIyUGFydGljbGVDb250YWN0LFxyXG4gIGIyUGFydGljbGVTeXN0ZW0sXHJcbn0gZnJvbSAnLi4vcGFydGljbGUvYjJQYXJ0aWNsZVN5c3RlbSc7XHJcblxyXG4vLy8gSm9pbnRzIGFuZCBmaXh0dXJlcyBhcmUgZGVzdHJveWVkIHdoZW4gdGhlaXIgYXNzb2NpYXRlZFxyXG4vLy8gYm9keSBpcyBkZXN0cm95ZWQuIEltcGxlbWVudCB0aGlzIGxpc3RlbmVyIHNvIHRoYXQgeW91XHJcbi8vLyBtYXkgbnVsbGlmeSByZWZlcmVuY2VzIHRvIHRoZXNlIGpvaW50cyBhbmQgc2hhcGVzLlxyXG5leHBvcnQgY2xhc3MgYjJEZXN0cnVjdGlvbkxpc3RlbmVyIHtcclxuICAvLy8gQ2FsbGVkIHdoZW4gYW55IGpvaW50IGlzIGFib3V0IHRvIGJlIGRlc3Ryb3llZCBkdWVcclxuICAvLy8gdG8gdGhlIGRlc3RydWN0aW9uIG9mIG9uZSBvZiBpdHMgYXR0YWNoZWQgYm9kaWVzLlxyXG4gIFNheUdvb2RieWVKb2ludChqb2ludDogYjJKb2ludCk6IHZvaWQge31cclxuXHJcbiAgLy8vIENhbGxlZCB3aGVuIGFueSBmaXh0dXJlIGlzIGFib3V0IHRvIGJlIGRlc3Ryb3llZCBkdWVcclxuICAvLy8gdG8gdGhlIGRlc3RydWN0aW9uIG9mIGl0cyBwYXJlbnQgYm9keS5cclxuICBTYXlHb29kYnllRml4dHVyZShmaXh0dXJlOiBiMkZpeHR1cmUpOiB2b2lkIHt9XHJcblxyXG4gIC8vICNpZiBCMl9FTkFCTEVfUEFSVElDTEVcclxuICAvLy8gQ2FsbGVkIHdoZW4gYW55IHBhcnRpY2xlIGdyb3VwIGlzIGFib3V0IHRvIGJlIGRlc3Ryb3llZC5cclxuICBTYXlHb29kYnllUGFydGljbGVHcm91cChncm91cDogYjJQYXJ0aWNsZUdyb3VwKTogdm9pZCB7fVxyXG5cclxuICAvLy8gQ2FsbGVkIHdoZW4gYSBwYXJ0aWNsZSBpcyBhYm91dCB0byBiZSBkZXN0cm95ZWQuXHJcbiAgLy8vIFRoZSBpbmRleCBjYW4gYmUgdXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoXHJcbiAgLy8vIGIyUGFydGljbGVTeXN0ZW06OkdldFVzZXJEYXRhQnVmZmVyKCkgb3JcclxuICAvLy8gYjJQYXJ0aWNsZVN5c3RlbTo6R2V0UGFydGljbGVIYW5kbGVGcm9tSW5kZXgoKSB0byBkZXRlcm1pbmUgd2hpY2hcclxuICAvLy8gcGFydGljbGUgaGFzIGJlZW4gZGVzdHJveWVkLlxyXG4gIFNheUdvb2RieWVQYXJ0aWNsZShzeXN0ZW06IGIyUGFydGljbGVTeXN0ZW0sIGluZGV4OiBudW1iZXIpOiB2b2lkIHt9XHJcblxyXG4gIC8vICNlbmRpZlxyXG59XHJcblxyXG4vLy8gSW1wbGVtZW50IHRoaXMgY2xhc3MgdG8gcHJvdmlkZSBjb2xsaXNpb24gZmlsdGVyaW5nLiBJbiBvdGhlciB3b3JkcywgeW91IGNhbiBpbXBsZW1lbnRcclxuLy8vIHRoaXMgY2xhc3MgaWYgeW91IHdhbnQgZmluZXIgY29udHJvbCBvdmVyIGNvbnRhY3QgY3JlYXRpb24uXHJcbmV4cG9ydCBjbGFzcyBiMkNvbnRhY3RGaWx0ZXIge1xyXG4gIC8vLyBSZXR1cm4gdHJ1ZSBpZiBjb250YWN0IGNhbGN1bGF0aW9ucyBzaG91bGQgYmUgcGVyZm9ybWVkIGJldHdlZW4gdGhlc2UgdHdvIHNoYXBlcy5cclxuICAvLy8gQHdhcm5pbmcgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMgdGhpcyBpcyBvbmx5IGNhbGxlZCB3aGVuIHRoZSBBQUJCcyBiZWdpbiB0byBvdmVybGFwLlxyXG4gIFNob3VsZENvbGxpZGUoZml4dHVyZUE6IGIyRml4dHVyZSwgZml4dHVyZUI6IGIyRml4dHVyZSk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgYm9keUEgPSBmaXh0dXJlQS5HZXRCb2R5KCk7XHJcbiAgICBjb25zdCBib2R5QiA9IGZpeHR1cmVCLkdldEJvZHkoKTtcclxuXHJcbiAgICAvLyBBdCBsZWFzdCBvbmUgYm9keSBzaG91bGQgYmUgZHluYW1pYyBvciBraW5lbWF0aWMuXHJcbiAgICBpZiAoXHJcbiAgICAgIGJvZHlCLkdldFR5cGUoKSA9PT0gYjJCb2R5VHlwZS5iMl9zdGF0aWNCb2R5ICYmXHJcbiAgICAgIGJvZHlBLkdldFR5cGUoKSA9PT0gYjJCb2R5VHlwZS5iMl9zdGF0aWNCb2R5XHJcbiAgICApIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERvZXMgYSBqb2ludCBwcmV2ZW50IGNvbGxpc2lvbj9cclxuICAgIGlmICghYm9keUIuU2hvdWxkQ29sbGlkZUNvbm5lY3RlZChib2R5QSkpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZpbHRlcjE6IGIyRmlsdGVyID0gZml4dHVyZUEuR2V0RmlsdGVyRGF0YSgpO1xyXG4gICAgY29uc3QgZmlsdGVyMjogYjJGaWx0ZXIgPSBmaXh0dXJlQi5HZXRGaWx0ZXJEYXRhKCk7XHJcblxyXG4gICAgaWYgKGZpbHRlcjEuZ3JvdXBJbmRleCA9PT0gZmlsdGVyMi5ncm91cEluZGV4ICYmIGZpbHRlcjEuZ3JvdXBJbmRleCAhPT0gMCkge1xyXG4gICAgICByZXR1cm4gZmlsdGVyMS5ncm91cEluZGV4ID4gMDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjb2xsaWRlOiBib29sZWFuID1cclxuICAgICAgKGZpbHRlcjEubWFza0JpdHMgJiBmaWx0ZXIyLmNhdGVnb3J5Qml0cykgIT09IDAgJiZcclxuICAgICAgKGZpbHRlcjEuY2F0ZWdvcnlCaXRzICYgZmlsdGVyMi5tYXNrQml0cykgIT09IDA7XHJcbiAgICByZXR1cm4gY29sbGlkZTtcclxuICB9XHJcblxyXG4gIC8vICNpZiBCMl9FTkFCTEVfUEFSVElDTEVcclxuICBTaG91bGRDb2xsaWRlRml4dHVyZVBhcnRpY2xlKFxyXG4gICAgZml4dHVyZTogYjJGaXh0dXJlLFxyXG4gICAgc3lzdGVtOiBiMlBhcnRpY2xlU3lzdGVtLFxyXG4gICAgaW5kZXg6IG51bWJlcixcclxuICApOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgU2hvdWxkQ29sbGlkZVBhcnRpY2xlUGFydGljbGUoc3lzdGVtOiBiMlBhcnRpY2xlU3lzdGVtLCBpbmRleEE6IG51bWJlciwgaW5kZXhCOiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLy8gI2VuZGlmXHJcblxyXG4gIHN0YXRpYyByZWFkb25seSBiMl9kZWZhdWx0RmlsdGVyOiBiMkNvbnRhY3RGaWx0ZXIgPSBuZXcgYjJDb250YWN0RmlsdGVyKCk7XHJcbn1cclxuXHJcbi8vLyBDb250YWN0IGltcHVsc2VzIGZvciByZXBvcnRpbmcuIEltcHVsc2VzIGFyZSB1c2VkIGluc3RlYWQgb2YgZm9yY2VzIGJlY2F1c2VcclxuLy8vIHN1Yi1zdGVwIGZvcmNlcyBtYXkgYXBwcm9hY2ggaW5maW5pdHkgZm9yIHJpZ2lkIGJvZHkgY29sbGlzaW9ucy4gVGhlc2VcclxuLy8vIG1hdGNoIHVwIG9uZS10by1vbmUgd2l0aCB0aGUgY29udGFjdCBwb2ludHMgaW4gYjJNYW5pZm9sZC5cclxuZXhwb3J0IGNsYXNzIGIyQ29udGFjdEltcHVsc2Uge1xyXG4gIG5vcm1hbEltcHVsc2VzOiBudW1iZXJbXSA9IGIyTWFrZU51bWJlckFycmF5KGIyX21heE1hbmlmb2xkUG9pbnRzKTtcclxuICB0YW5nZW50SW1wdWxzZXM6IG51bWJlcltdID0gYjJNYWtlTnVtYmVyQXJyYXkoYjJfbWF4TWFuaWZvbGRQb2ludHMpO1xyXG4gIGNvdW50ID0gMDtcclxufVxyXG5cclxuLy8vIEltcGxlbWVudCB0aGlzIGNsYXNzIHRvIGdldCBjb250YWN0IGluZm9ybWF0aW9uLiBZb3UgY2FuIHVzZSB0aGVzZSByZXN1bHRzIGZvclxyXG4vLy8gdGhpbmdzIGxpa2Ugc291bmRzIGFuZCBnYW1lIGxvZ2ljLiBZb3UgY2FuIGFsc28gZ2V0IGNvbnRhY3QgcmVzdWx0cyBieVxyXG4vLy8gdHJhdmVyc2luZyB0aGUgY29udGFjdCBsaXN0cyBhZnRlciB0aGUgdGltZSBzdGVwLiBIb3dldmVyLCB5b3UgbWlnaHQgbWlzc1xyXG4vLy8gc29tZSBjb250YWN0cyBiZWNhdXNlIGNvbnRpbnVvdXMgcGh5c2ljcyBsZWFkcyB0byBzdWItc3RlcHBpbmcuXHJcbi8vLyBBZGRpdGlvbmFsbHkgeW91IG1heSByZWNlaXZlIG11bHRpcGxlIGNhbGxiYWNrcyBmb3IgdGhlIHNhbWUgY29udGFjdCBpbiBhXHJcbi8vLyBzaW5nbGUgdGltZSBzdGVwLlxyXG4vLy8gWW91IHNob3VsZCBzdHJpdmUgdG8gbWFrZSB5b3VyIGNhbGxiYWNrcyBlZmZpY2llbnQgYmVjYXVzZSB0aGVyZSBtYXkgYmVcclxuLy8vIG1hbnkgY2FsbGJhY2tzIHBlciB0aW1lIHN0ZXAuXHJcbi8vLyBAd2FybmluZyBZb3UgY2Fubm90IGNyZWF0ZS9kZXN0cm95IEJveDJEIGVudGl0aWVzIGluc2lkZSB0aGVzZSBjYWxsYmFja3MuXHJcbmV4cG9ydCBjbGFzcyBiMkNvbnRhY3RMaXN0ZW5lciB7XHJcbiAgLy8vIENhbGxlZCB3aGVuIHR3byBmaXh0dXJlcyBiZWdpbiB0byB0b3VjaC5cclxuICBCZWdpbkNvbnRhY3QoY29udGFjdDogYjJDb250YWN0KTogdm9pZCB7fVxyXG5cclxuICAvLy8gQ2FsbGVkIHdoZW4gdHdvIGZpeHR1cmVzIGNlYXNlIHRvIHRvdWNoLlxyXG4gIEVuZENvbnRhY3QoY29udGFjdDogYjJDb250YWN0KTogdm9pZCB7fVxyXG5cclxuICAvLyAjaWYgQjJfRU5BQkxFX1BBUlRJQ0xFXHJcbiAgQmVnaW5Db250YWN0Rml4dHVyZVBhcnRpY2xlKHN5c3RlbTogYjJQYXJ0aWNsZVN5c3RlbSwgY29udGFjdDogYjJQYXJ0aWNsZUJvZHlDb250YWN0KTogdm9pZCB7fVxyXG5cclxuICBFbmRDb250YWN0Rml4dHVyZVBhcnRpY2xlKHN5c3RlbTogYjJQYXJ0aWNsZVN5c3RlbSwgY29udGFjdDogYjJQYXJ0aWNsZUJvZHlDb250YWN0KTogdm9pZCB7fVxyXG5cclxuICBCZWdpbkNvbnRhY3RQYXJ0aWNsZVBhcnRpY2xlKHN5c3RlbTogYjJQYXJ0aWNsZVN5c3RlbSwgY29udGFjdDogYjJQYXJ0aWNsZUNvbnRhY3QpOiB2b2lkIHt9XHJcblxyXG4gIEVuZENvbnRhY3RQYXJ0aWNsZVBhcnRpY2xlKHN5c3RlbTogYjJQYXJ0aWNsZVN5c3RlbSwgY29udGFjdDogYjJQYXJ0aWNsZUNvbnRhY3QpOiB2b2lkIHt9XHJcblxyXG4gIC8vICNlbmRpZlxyXG5cclxuICAvLy8gVGhpcyBpcyBjYWxsZWQgYWZ0ZXIgYSBjb250YWN0IGlzIHVwZGF0ZWQuIFRoaXMgYWxsb3dzIHlvdSB0byBpbnNwZWN0IGFcclxuICAvLy8gY29udGFjdCBiZWZvcmUgaXQgZ29lcyB0byB0aGUgc29sdmVyLiBJZiB5b3UgYXJlIGNhcmVmdWwsIHlvdSBjYW4gbW9kaWZ5IHRoZVxyXG4gIC8vLyBjb250YWN0IG1hbmlmb2xkIChlLmcuIGRpc2FibGUgY29udGFjdCkuXHJcbiAgLy8vIEEgY29weSBvZiB0aGUgb2xkIG1hbmlmb2xkIGlzIHByb3ZpZGVkIHNvIHRoYXQgeW91IGNhbiBkZXRlY3QgY2hhbmdlcy5cclxuICAvLy8gTm90ZTogdGhpcyBpcyBjYWxsZWQgb25seSBmb3IgYXdha2UgYm9kaWVzLlxyXG4gIC8vLyBOb3RlOiB0aGlzIGlzIGNhbGxlZCBldmVuIHdoZW4gdGhlIG51bWJlciBvZiBjb250YWN0IHBvaW50cyBpcyB6ZXJvLlxyXG4gIC8vLyBOb3RlOiB0aGlzIGlzIG5vdCBjYWxsZWQgZm9yIHNlbnNvcnMuXHJcbiAgLy8vIE5vdGU6IGlmIHlvdSBzZXQgdGhlIG51bWJlciBvZiBjb250YWN0IHBvaW50cyB0byB6ZXJvLCB5b3Ugd2lsbCBub3RcclxuICAvLy8gZ2V0IGFuIEVuZENvbnRhY3QgY2FsbGJhY2suIEhvd2V2ZXIsIHlvdSBtYXkgZ2V0IGEgQmVnaW5Db250YWN0IGNhbGxiYWNrXHJcbiAgLy8vIHRoZSBuZXh0IHN0ZXAuXHJcbiAgUHJlU29sdmUoY29udGFjdDogYjJDb250YWN0LCBvbGRNYW5pZm9sZDogYjJNYW5pZm9sZCk6IHZvaWQge31cclxuXHJcbiAgLy8vIFRoaXMgbGV0cyB5b3UgaW5zcGVjdCBhIGNvbnRhY3QgYWZ0ZXIgdGhlIHNvbHZlciBpcyBmaW5pc2hlZC4gVGhpcyBpcyB1c2VmdWxcclxuICAvLy8gZm9yIGluc3BlY3RpbmcgaW1wdWxzZXMuXHJcbiAgLy8vIE5vdGU6IHRoZSBjb250YWN0IG1hbmlmb2xkIGRvZXMgbm90IGluY2x1ZGUgdGltZSBvZiBpbXBhY3QgaW1wdWxzZXMsIHdoaWNoIGNhbiBiZVxyXG4gIC8vLyBhcmJpdHJhcmlseSBsYXJnZSBpZiB0aGUgc3ViLXN0ZXAgaXMgc21hbGwuIEhlbmNlIHRoZSBpbXB1bHNlIGlzIHByb3ZpZGVkIGV4cGxpY2l0bHlcclxuICAvLy8gaW4gYSBzZXBhcmF0ZSBkYXRhIHN0cnVjdHVyZS5cclxuICAvLy8gTm90ZTogdGhpcyBpcyBvbmx5IGNhbGxlZCBmb3IgY29udGFjdHMgdGhhdCBhcmUgdG91Y2hpbmcsIHNvbGlkLCBhbmQgYXdha2UuXHJcbiAgUG9zdFNvbHZlKGNvbnRhY3Q6IGIyQ29udGFjdCwgaW1wdWxzZTogYjJDb250YWN0SW1wdWxzZSk6IHZvaWQge31cclxuXHJcbiAgc3RhdGljIHJlYWRvbmx5IGIyX2RlZmF1bHRMaXN0ZW5lcjogYjJDb250YWN0TGlzdGVuZXIgPSBuZXcgYjJDb250YWN0TGlzdGVuZXIoKTtcclxufVxyXG5cclxuLy8vIENhbGxiYWNrIGNsYXNzIGZvciBBQUJCIHF1ZXJpZXMuXHJcbi8vLyBTZWUgYjJXb3JsZDo6UXVlcnlcclxuZXhwb3J0IGNsYXNzIGIyUXVlcnlDYWxsYmFjayB7XHJcbiAgLy8vIENhbGxlZCBmb3IgZWFjaCBmaXh0dXJlIGZvdW5kIGluIHRoZSBxdWVyeSBBQUJCLlxyXG4gIC8vLyBAcmV0dXJuIGZhbHNlIHRvIHRlcm1pbmF0ZSB0aGUgcXVlcnkuXHJcbiAgUmVwb3J0Rml4dHVyZShmaXh0dXJlOiBiMkZpeHR1cmUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLy8gI2lmIEIyX0VOQUJMRV9QQVJUSUNMRVxyXG4gIFJlcG9ydFBhcnRpY2xlKHN5c3RlbTogYjJQYXJ0aWNsZVN5c3RlbSwgaW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgU2hvdWxkUXVlcnlQYXJ0aWNsZVN5c3RlbShzeXN0ZW06IGIyUGFydGljbGVTeXN0ZW0pOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLy8gI2VuZGlmXHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIGIyUXVlcnlDYWxsYmFja0Z1bmN0aW9uID0gKGZpeHR1cmU6IGIyRml4dHVyZSkgPT4gYm9vbGVhbjtcclxuXHJcbi8vLyBDYWxsYmFjayBjbGFzcyBmb3IgcmF5IGNhc3RzLlxyXG4vLy8gU2VlIGIyV29ybGQ6OlJheUNhc3RcclxuZXhwb3J0IGNsYXNzIGIyUmF5Q2FzdENhbGxiYWNrIHtcclxuICAvLy8gQ2FsbGVkIGZvciBlYWNoIGZpeHR1cmUgZm91bmQgaW4gdGhlIHF1ZXJ5LiBZb3UgY29udHJvbCBob3cgdGhlIHJheSBjYXN0XHJcbiAgLy8vIHByb2NlZWRzIGJ5IHJldHVybmluZyBhIGZsb2F0OlxyXG4gIC8vLyByZXR1cm4gLTE6IGlnbm9yZSB0aGlzIGZpeHR1cmUgYW5kIGNvbnRpbnVlXHJcbiAgLy8vIHJldHVybiAwOiB0ZXJtaW5hdGUgdGhlIHJheSBjYXN0XHJcbiAgLy8vIHJldHVybiBmcmFjdGlvbjogY2xpcCB0aGUgcmF5IHRvIHRoaXMgcG9pbnRcclxuICAvLy8gcmV0dXJuIDE6IGRvbid0IGNsaXAgdGhlIHJheSBhbmQgY29udGludWVcclxuICAvLy8gQHBhcmFtIGZpeHR1cmUgdGhlIGZpeHR1cmUgaGl0IGJ5IHRoZSByYXlcclxuICAvLy8gQHBhcmFtIHBvaW50IHRoZSBwb2ludCBvZiBpbml0aWFsIGludGVyc2VjdGlvblxyXG4gIC8vLyBAcGFyYW0gbm9ybWFsIHRoZSBub3JtYWwgdmVjdG9yIGF0IHRoZSBwb2ludCBvZiBpbnRlcnNlY3Rpb25cclxuICAvLy8gQHJldHVybiAtMSB0byBmaWx0ZXIsIDAgdG8gdGVybWluYXRlLCBmcmFjdGlvbiB0byBjbGlwIHRoZSByYXkgZm9yXHJcbiAgLy8vIGNsb3Nlc3QgaGl0LCAxIHRvIGNvbnRpbnVlXHJcbiAgUmVwb3J0Rml4dHVyZShmaXh0dXJlOiBiMkZpeHR1cmUsIHBvaW50OiBiMlZlYzIsIG5vcm1hbDogYjJWZWMyLCBmcmFjdGlvbjogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgIHJldHVybiBmcmFjdGlvbjtcclxuICB9XHJcblxyXG4gIC8vICNpZiBCMl9FTkFCTEVfUEFSVElDTEVcclxuICBSZXBvcnRQYXJ0aWNsZShcclxuICAgIHN5c3RlbTogYjJQYXJ0aWNsZVN5c3RlbSxcclxuICAgIGluZGV4OiBudW1iZXIsXHJcbiAgICBwb2ludDogYjJWZWMyLFxyXG4gICAgbm9ybWFsOiBiMlZlYzIsXHJcbiAgICBmcmFjdGlvbjogbnVtYmVyLFxyXG4gICk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcblxyXG4gIFNob3VsZFF1ZXJ5UGFydGljbGVTeXN0ZW0oc3lzdGVtOiBiMlBhcnRpY2xlU3lzdGVtKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8vICNlbmRpZlxyXG59XHJcblxyXG5leHBvcnQgdHlwZSBiMlJheUNhc3RDYWxsYmFja0Z1bmN0aW9uID0gKFxyXG4gIGZpeHR1cmU6IGIyRml4dHVyZSxcclxuICBwb2ludDogYjJWZWMyLFxyXG4gIG5vcm1hbDogYjJWZWMyLFxyXG4gIGZyYWN0aW9uOiBudW1iZXIsXHJcbikgPT4gbnVtYmVyO1xyXG4iXX0=